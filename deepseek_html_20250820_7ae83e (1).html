<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèóÔ∏è</text></svg>">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --edit: #9b59b6;
            --admin: #d35400;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background-color: var(--light);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 12px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark);
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-box {
            background: var(--light);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #777;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        th, td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin: 5px 0;
            transition: background 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-edit {
            background-color: var(--edit);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-admin {
            background-color: var(--admin);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-good {
            color: var(--success);
            font-weight: 600;
        }
        
        .status-warning {
            color: var(--warning);
            font-weight: 600;
        }
        
        .status-danger {
            color: var(--danger);
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            animation: modalFade 0.3s;
        }
        
        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .hidden {
            display: none;
        }
        
        .github-info {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        
        .admin-badge {
            background: var(--admin);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .storage-badge {
            background: var(--secondary);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 0 5px;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 900px;
            }
            
            .stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .btn {
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="github-info">
        <h3>üèóÔ∏è ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©</h3>
        <p>ÿ™ŸÖ ÿßŸÜÿ¥ÿßÿ° Ÿáÿ∞ÿß ÿßŸÑŸÖŸàŸÇÿπ Ÿàÿ™ÿ∑ŸàŸäÿ±Ÿá ÿ®Ÿä Ÿàÿßÿ≥ÿ∑ÿ© ŸÖÿ≠ŸÖÿØ ÿ±ÿ¥ÿßÿØ  | Hamo</p>
    </div>

    <div id="loginPage" class="login-container">
        <h2 class="login-title">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ  üî•</h2>
        <div class="form-group">
            <label for="username">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
            <input type="text" id="username" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ">
        </div>
        <div class="form-group">
            <label for="password">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
            <input type="password" id="password" placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±">
        </div>
        <div class="form-group">
            <label for="storageUnit">ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
            <select id="storageUnit">
                <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
            </select>
        </div>
        <button class="btn btn-full" onclick="login()">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
        <p style="text-align: center; margin-top: 15px;">
            ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü <a href="#" onclick="showRegisterForm()">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</a>
        </p>
        
        <div class="alert alert-info" style="margin-top: 20px;">
            <strong>ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏Ÿá ŸÑÿØŸä </strong><br>
            ŸÖÿ≠ŸÖÿØ ÿ±ÿ¥ÿßÿØ|: hamo<br>
             
        </div>
    </div>

    <div id="registerPage" class="login-container hidden">
        <h2 class="login-title">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</h2>
        <div class="form-group">
            <label for="newUsername">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
            <input type="text" id="newUsername" placeholder="ÿßÿÆÿ™ÿ± ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ">
        </div>
        <div class="form-group">
            <label for="newPassword">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
            <input type="password" id="newPassword" placeholder="ÿßÿÆÿ™ÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±">
        </div>
        <div class="form-group">
            <label for="confirmPassword">ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
            <input type="password" id="confirmPassword" placeholder="ÿ£ÿπÿØ ÿ•ÿØÿÆÿßŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±">
        </div>
        <div class="form-group">
            <label for="newStorageUnit">ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</label>
            <select id="newStorageUnit">
                <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
            </select>
        </div>
        <div class="form-group" id="adminCheckboxContainer" style="display: none;">
            <label>
                <input type="checkbox" id="isAdmin"> ŸÖŸÜÿ≠ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿØŸäÿ±
            </label>
        </div>
        <button class="btn btn-full" onclick="register()">ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®</button>
        <p style="text-align: center; margin-top: 15px;">
            ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ® ÿ®ÿßŸÑŸÅÿπŸÑÿü <a href="#" onclick="showLoginForm()">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</a>
        </p>
    </div>

    <div id="app" class="container hidden">
        <header>
            <div>
                <h1>ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©</h1>
                <div class="subtitle" id="storageUnitName">ÿßŸÑŸÖÿÆÿ≤ŸÜ: ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
            </div>
            <div class="user-info">
                <span id="currentUser">
                    <span id="userDisplayName">ŸÖÿ≥ÿ™ÿÆÿØŸÖ</span>
                    <span id="adminBadge" class="admin-badge hidden">ŸÖÿØŸäÿ±</span>
                </span>
                <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab('main')">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</button>
            <button class="tab" onclick="openTab('products')">ÿßŸÑŸÖŸàÿßÿØ</button>
            <button class="tab" onclick="openTab('additions')">ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™</button>
            <button class="tab" onclick="openTab('withdrawals')">ÿßŸÑÿµÿ±ŸÅ</button>
            <button class="tab" onclick="openTab('inventory')">ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</button>
            <button class="tab" onclick="openTab('users')">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</button>
            <button class="tab" onclick="openTab('storage')" id="storageTab">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ</button>
        </div>
        
        <div id="main" class="tab-content active">
            <h2>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h2>
            
            <input type="text" class="search-box" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿßÿØÿ© (ŸÖÿ´ÿßŸÑ: ÿ£ÿ≥ŸÖŸÜÿ™)" onkeyup="searchProduct()" id="searchInput">
            
            <div class="card">
                <div class="card-title">ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´</div>
                <div id="searchResults">
                    <p>ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖ ŸÖÿßÿØÿ© ŸÅŸä ŸÖÿ±ÿ®ÿπ ÿßŸÑÿ®ÿ≠ÿ´ ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨</p>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">ÿπÿØÿØ ÿßŸÑŸÖŸàÿßÿØ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalAdditions">0</div>
                    <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalWithdrawals">0</div>
                    <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿµÿ±ŸÅ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="lowStock">0</div>
                    <div class="stat-label">ŸÖŸàÿßÿØ ŸÖŸÜÿÆŸÅÿ∂ÿ©</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ÿ¢ÿÆÿ± ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                            <th>ŸÜŸàÿπ ÿßŸÑÿ≠ÿ±ŸÉÿ©</th>
                            <th>ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑŸÉŸÖŸäÿ©</th>
                            <th>ÿßŸÑŸÖÿÆÿ≤ŸÜ</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                        </tr>
                    </thead>
                    <tbody id="lastTransactions">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="products" class="tab-content">
            <h2>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿßÿØ</h2>
            
            <div class="alert alert-info">
                ŸáŸÜÿß ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© Ÿàÿ™ÿπÿØŸäŸÑ Ÿàÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿßÿØ ŸÅŸä ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ
            </div>
            
            <div class="card">
                <div class="card-title">ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿßÿØÿ© ÿ¨ÿØŸäÿØÿ©</div>
                <div class="form-group">
                    <label for="productName">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©</label>
                    <input type="text" id="productName" placeholder="ŸÖÿ´ÿßŸÑ: ÿ£ÿ≥ŸÖŸÜÿ™">
                </div>
                <div class="form-group">
                    <label for="productUnit">ÿßŸÑŸàÿ≠ÿØÿ©</label>
                    <select id="productUnit">
                        <option value="ŸÉÿ¨ŸÖ">ŸÉÿ¨ŸÖ</option>
                        <option value="ÿ¥ŸäŸÉÿßÿ±ÿ©">ÿ¥ŸäŸÉÿßÿ±ÿ©</option>
                        <option value="ÿ∑ŸÜ">ÿ∑ŸÜ</option>
                        <option value="ŸÖÿ™ÿ±">ŸÖÿ™ÿ±</option>
                        <option value="ŸÖÿ™ÿ± ŸÖŸÉÿπÿ®">ŸÖÿ™ÿ± ŸÖŸÉÿπÿ®</option>
                        <option value="ŸÑÿ™ÿ±">ŸÑÿ™ÿ±</option>
                        <option value="ÿπŸÑÿ®ÿ©">ÿπŸÑÿ®ÿ©</option>
                        <option value="ŸÉŸäÿ≥">ŸÉŸäÿ≥</option>
                        <option value="ŸÇÿ∑ÿπÿ©">ŸÇÿ∑ÿπÿ©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productMinStock">ÿ≠ÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∑ŸÑÿ®</label>
                    <input type="number" id="productMinStock" placeholder="ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑŸÖÿÆÿ≤ŸàŸÜ">
                </div>
                <div class="form-group">
                    <label for="productCategory">ÿßŸÑŸÅÿ¶ÿ©</label>
                    <select id="productCategory">
                        <option value="ŸÖŸàÿßÿØ ÿ®ŸÜÿßÿ°">ŸÖŸàÿßÿØ ÿ®ŸÜÿßÿ°</option>
                        <option value="ÿØŸáÿßŸÜÿßÿ™">ÿØŸáÿßŸÜÿßÿ™</option>
                        <option value="ÿ£ÿØŸàÿßÿ™">ÿ£ÿØŸàÿßÿ™</option>
                        <option value="ŸÉŸáÿ±ÿ®ÿßÿ°">ŸÉŸáÿ±ÿ®ÿßÿ°</option>
                        <option value="ÿ≥ÿ®ÿßŸÉÿ©">ÿ≥ÿ®ÿßŸÉÿ©</option>
                        <option value="ÿ£ÿÆÿ±Ÿâ">ÿ£ÿÆÿ±Ÿâ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                    <input type="text" id="productNotes" placeholder="ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©">
                </div>
                <button class="btn btn-success" onclick="addProduct()"><i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿßÿØÿ©</button>
            </div>
            
            <div class="card">
                <div class="card-title">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿßÿØ</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑŸàÿ≠ÿØÿ©</th>
                            <th>ÿßŸÑŸÅÿ¶ÿ©</th>
                            <th>ÿ≠ÿØ ÿßŸÑÿ∑ŸÑÿ®</th>
                            <th>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                        </tr>
                    </thead>
                    <tbody id="productsList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="additions" class="tab-content">
            <h2>ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™</h2>
            
            <div class="card">
                <div class="card-title">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ÿØŸäÿØÿ©</div>
                <div class="form-group">
                    <label for="addDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                    <input type="date" id="addDate">
                </div>
                <div class="form-group">
                    <label for="addStorage">ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <select id="addStorage">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="addProduct">ÿßŸÑŸÖÿßÿØÿ©</label>
                    <select id="addProduct">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="addQuantity">ÿßŸÑŸÉŸÖŸäÿ©</label>
                    <input type="number" id="addQuantity" placeholder="ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∂ÿßŸÅÿ©">
                </div>
                <div class="form-group">
                    <label for="addPrice">ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ©</label>
                    <input type="number" id="addPrice" placeholder="ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ©">
                </div>
                <div class="form-group">
                    <label for="addSupplier">ÿßŸÑŸÖŸàÿ±ÿØ</label>
                    <input type="text" id="addSupplier" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ±ÿØ">
                </div>
                <div class="form-group">
                    <label for="addDoc">ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ</label>
                    <input type="text" id="addDoc" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ">
                </div>
                <button class="btn btn-success" onclick="addAddition()"><i class="fas fa-plus"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©</button>
            </div>
            
            <div class="card">
                <div class="card-title">ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                            <th>ÿßŸÑŸÖÿÆÿ≤ŸÜ</th>
                            <th>ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑŸÉŸÖŸäÿ©</th>
                            <th>ÿßŸÑÿ≥ÿπÿ±</th>
                            <th>ÿßŸÑŸÇŸäŸÖÿ©</th>
                            <th>ÿßŸÑŸÖŸàÿ±ÿØ</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                        </tr>
                    </thead>
                    <tbody id="additionsList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="withdrawals" class="tab-content">
            <h2>ÿ≥ÿ¨ŸÑ ÿßŸÑÿµÿ±ŸÅ</h2>
            
            <div class="card">
                <div class="card-title">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµÿ±ŸÅ ÿ¨ÿØŸäÿØ</div>
                <div class="form-group">
                    <label for="withdrawDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                    <input type="date" id="withdrawDate">
                </div>
                <div class="form-group">
                    <label for="withdrawStorage">ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <select id="withdrawStorage">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="withdrawProduct">ÿßŸÑŸÖÿßÿØÿ©</label>
                    <select id="withdrawProduct">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="withdrawQuantity">ÿßŸÑŸÉŸÖŸäÿ©</label>
                    <input type="number" id="withdrawQuantity" placeholder="ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿ©">
                </div>
                <div class="form-group">
                    <label for="withdrawReceiver">ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ/ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</label>
                    <input type="text" id="withdrawReceiver" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ ÿ£Ÿà ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ">
                </div>
                <div class="form-group">
                    <label for="withdrawDoc">ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ</label>
                    <input type="text" id="withdrawDoc" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ">
                </div>
                <button class="btn btn-success" onclick="addWithdrawal()"><i class="fas fa-plus"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµÿ±ŸÅ</button>
            </div>
            
            <div class="card">
                <div class="card-title">ÿ≥ÿ¨ŸÑ ÿßŸÑÿµÿ±ŸÅ</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                            <th>ÿßŸÑŸÖÿÆÿ≤ŸÜ</th>
                            <th>ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑŸÉŸÖŸäÿ©</th>
                            <th>ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ</th>
                            <th>ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawalsList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="inventory" class="tab-content">
            <h2>ÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</h2>
            
            <div class="card">
                <div class="card-title">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÑÿπÿ±ÿ∂ ÿ™ŸÇÿ±Ÿäÿ±Ÿá</div>
                <div class="form-group">
                    <select id="inventoryStorage" onchange="updateInventory()">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </select>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ŸÖŸÑÿÆÿµ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ÿßŸÑÿ≠ÿßŸÑŸä</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™</th>
                            <th>ÿßŸÑÿµÿ±ŸÅ</th>
                            <th>ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</th>
                            <th>ÿ≠ÿØ ÿßŸÑÿ∑ŸÑÿ®</th>
                            <th>ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                        </tr>
                    </thead>
                    <tbody id="inventorySummary">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <div class="card-title">ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑÿ™Ÿä ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ•ÿπÿßÿØÿ© ÿ∑ŸÑÿ®</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßŸÑŸÖÿßÿØÿ©</th>
                            <th>ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</th>
                            <th>ÿ≠ÿØ ÿßŸÑÿ∑ŸÑÿ®</th>
                            <th>ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                        </tr>
                    </thead>
                    <tbody id="lowStockItems">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <div class="card-title">ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©</div>
                <button class="btn btn-full" onclick="printReport()"><i class="fas fa-print"></i> ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±</button>
                <button class="btn btn-full btn-success" onclick="exportData()"><i class="fas fa-download"></i> ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</button>
            </div>
        </div>
        
        <div id="users" class="tab-content">
            <h2>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</h2>
            
            <div class="alert alert-info">
                Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖÿ™ÿßÿ≠ÿ© ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿØŸäÿ±ŸäŸÜ
            </div>
            
            <div class="card">
                <div class="card-title">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ ÿßŸÑÿ≠ÿßŸÑŸäŸàŸÜ</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</th>
                            <th>ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä</th>
                            <th>ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÖÿØŸäÿ±</th>
                            <th>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                        </tr>
                    </thead>
                    <tbody id="usersList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="storage" class="tab-content">
            <h2>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ</h2>
            
            <div class="alert alert-info">
                Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖÿ™ÿßÿ≠ÿ© ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿØŸäÿ±ŸäŸÜ
            </div>
            
            <div class="card">
                <div class="card-title">ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿÆÿ≤ŸÜ ÿ¨ÿØŸäÿØ</div>
                <div class="form-group">
                    <label for="storageName">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <input type="text" id="storageName" placeholder="ŸÖÿ´ÿßŸÑ: ŸÖÿÆÿ≤ŸÜ ÿ£ŸÉÿ™Ÿàÿ®ÿ±">
                </div>
                <div class="form-group">
                    <label for="storageLocation">ÿßŸÑŸÖŸàŸÇÿπ</label>
                    <input type="text" id="storageLocation" placeholder="ŸÖŸàŸÇÿπ ÿßŸÑŸÖÿÆÿ≤ŸÜ">
                </div>
                <div class="form-group">
                    <label for="storageManager">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                    <input type="text" id="storageManager" placeholder="ÿßÿ≥ŸÖ ŸÖÿ≥ÿ§ŸàŸÑ ÿßŸÑŸÖÿÆÿ≤ŸÜ">
                </div>
                <div class="form-group">
                    <label for="storagePhone">Ÿáÿßÿ™ŸÅ ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <input type="text" id="storagePhone" placeholder="Ÿáÿßÿ™ŸÅ ÿßŸÑÿßÿ™ÿµÿßŸÑ">
                </div>
                <button class="btn btn-success" onclick="addStorage()"><i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜ</button>
            </div>
            
            <div class="card">
                <div class="card-title">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ</div>
                <table>
                    <thead>
                        <tr>
                            <th>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜ</th>
                            <th>ÿßŸÑŸÖŸàŸÇÿπ</th>
                            <th>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</th>
                            <th>Ÿáÿßÿ™ŸÅ ÿßŸÑŸÖÿÆÿ≤ŸÜ</th>
                            <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                        </tr>
                    </thead>
                    <tbody id="storageList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deleteModal')">&times;</span>
            <h3>ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ</h3>
            <p id="deleteMessage">ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅÿü</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-full btn-danger" onclick="deleteItem()">ŸÜÿπŸÖÿå ÿßÿ≠ÿ∞ŸÅ</button>
                <button class="btn btn-full" onclick="closeModal('deleteModal')">ÿ•ŸÑÿ∫ÿßÿ°</button>
            </div>
        </div>
    </div>

    <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ÿπÿØŸäŸÑ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editModal')">&times;</span>
            <h3 id="editModalTitle">ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿµŸÜŸÅ</h3>
            <div id="editModalContent">
                <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß -->
            </div>
        </div>
    </div>

    <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ -->
    <div id="permissionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('permissionModal')">&times;</span>
            <h3 id="permissionModalTitle">ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™</h3>
            <div class="form-group">
                <label for="userPermission">ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</label>
                <select id="userPermission">
                    <option value="user">ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿπÿßÿØŸä</option>
                    <option value="admin">ŸÖÿØŸäÿ±</option>
                </select>
            </div>
            <button class="btn btn-full btn-admin" onclick="saveUserPermission()"><i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™</button>
        </div>
    </div>

    <script>
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ
        let products = JSON.parse(localStorage.getItem('construction_products')) || [];
        let additions = JSON.parse(localStorage.getItem('construction_additions')) || [];
        let withdrawals = JSON.parse(localStorage.getItem('construction_withdrawals')) || [];
        let users = JSON.parse(localStorage.getItem('construction_users')) || [
            { username: 'hamo', password: '205347', storageUnit: 'ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä', isAdmin: true, registrationDate: new Date().toLocaleDateString('ar-EG') }
        ];
        let storages = JSON.parse(localStorage.getItem('construction_storages')) || [
            { id: 1, name: 'ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä', location: 'ÿßŸÑŸÖŸÇÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä', manager: 'ŸÖÿØŸäÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ', phone: '01000000000' },
            { id: 2, name: 'ŸÖÿÆÿ≤ŸÜ ÿ£ŸÉÿ™Ÿàÿ®ÿ±', location: 'ŸÖÿØŸäŸÜÿ© 6 ÿ£ŸÉÿ™Ÿàÿ®ÿ±', manager: 'ŸÖÿ≥ÿ§ŸàŸÑ ÿ£ŸÉÿ™Ÿàÿ®ÿ±', phone: '01111111111' },
            { id: 3, name: 'ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ', location: 'ŸÖÿ≠ÿßŸÅÿ∏ÿ© ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ', manager: 'ŸÖÿ≥ÿ§ŸàŸÑ ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ', phone: '01222222222' }
        ];
        
        // ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
        let currentUser = null;
        
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÑŸÑÿ≠ÿ∞ŸÅ
        let itemToDelete = null;
        let itemTypeToDelete = null;
        let userToEdit = null;
        
        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ
        function initSystem() {
            // ÿ™ÿπŸäŸäŸÜ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ŸÉŸÇŸäŸÖÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('addDate').value = today;
            document.getElementById('withdrawDate').value = today;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
            updateStats();
            
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            loadProducts();
            loadAdditions();
            loadWithdrawals();
            loadUsers();
            loadStorages();
            updateInventory();
            updateLastTransactions();
            
            // ŸÖŸÑÿ° ŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸàÿßŸÑÿµÿ±ŸÅ
            populateProductSelects();
            populateStorageSelects();
            
            // ÿπÿ±ÿ∂ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸàŸàÿ≠ÿØÿ© ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ
            document.getElementById('userDisplayName').textContent = currentUser.username;
            document.getElementById('storageUnitName').textContent = `ÿßŸÑŸÖÿÆÿ≤ŸÜ: ${currentUser.storageUnit}`;
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÖÿØŸäÿ±
            if (currentUser.isAdmin) {
                document.getElementById('adminBadge').classList.remove('hidden');
            }
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿ£Ÿà ÿ•ÿÆŸÅÿßÿ° ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÖÿØŸäÿ±
            toggleAdminFeatures();
        }
        
        // ÿ•ÿ∏Ÿáÿßÿ± ÿ£Ÿà ÿ•ÿÆŸÅÿßÿ° ŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿØŸäÿ±
        function toggleAdminFeatures() {
            const isAdmin = currentUser.isAdmin;
            
            // ÿ™ÿ®ŸàŸäÿ® ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ
            if (!isAdmin) {
                document.getElementById('storageTab').style.display = 'none';
            }
            
            // ÿ™ÿ®ŸàŸäÿ® ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
            if (!isAdmin) {
                const usersTab = document.querySelector('.tab[onclick="openTab(\'users\')"]');
                if (usersTab) usersTab.style.display = 'none';
            }
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿÆŸäÿßÿ± ŸÖŸÜÿ≠ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿØŸäÿ± ŸÑŸÑŸÖÿØŸäÿ±ŸäŸÜ ŸÅŸÇÿ∑
            if (isAdmin) {
                document.getElementById('adminCheckboxContainer').style.display = 'block';
            }
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        function updateStats() {
            document.getElementById('totalProducts').textContent = products.length;
            
            const totalAdditions = additions.reduce((sum, addition) => sum + addition.quantity, 0);
            document.getElementById('totalAdditions').textContent = totalAdditions;
            
            const totalWithdrawals = withdrawals.reduce((sum, withdrawal) => sum + withdrawal.quantity, 0);
            document.getElementById('totalWithdrawals').textContent = totalWithdrawals;
            
            // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑŸÖŸÜÿÆŸÅÿ∂ÿ©
            const lowStockCount = products.filter(product => {
                const additionsTotal = additions
                    .filter(a => a.product === product.name)
                    .reduce((sum, a) => sum + a.quantity, 0);
                
                const withdrawalsTotal = withdrawals
                    .filter(w => w.product === product.name)
                    .reduce((sum, w) => sum + w.quantity, 0);
                
                const remaining = additionsTotal - withdrawalsTotal;
                return remaining <= product.minStock;
            }).length;
            
            document.getElementById('lowStock').textContent = lowStockCount;
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸàÿßÿØ
        function loadProducts() {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';
            
            if (products.length === 0) {
                productsList.innerHTML = '<tr><td colspan="6" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿØ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.unit}</td>
                    <td>${product.category}</td>
                    <td>${product.minStock}</td>
                    <td>${product.notes || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editProduct(${product.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${product.id}, 'product')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                productsList.appendChild(row);
            });
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™
        function loadAdditions() {
            const additionsList = document.getElementById('additionsList');
            additionsList.innerHTML = '';
            
            if (additions.length === 0) {
                additionsList.innerHTML = '<tr><td colspan="8" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ∂ÿßŸÅÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                return;
            }
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™ ŸÖŸÜ ÿßŸÑÿ£ÿ≠ÿØÿ´ ÿ•ŸÑŸâ ÿßŸÑÿ£ŸÇÿØŸÖ
            const sortedAdditions = [...additions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedAdditions.forEach(addition => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${addition.date}</td>
                    <td><span class="storage-badge">${addition.storage}</span></td>
                    <td>${addition.product}</td>
                    <td>${addition.quantity}</td>
                    <td>${addition.price}</td>
                    <td>${addition.quantity * addition.price}</td>
                    <td>${addition.supplier}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editAddition(${addition.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${addition.id}, 'addition')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                additionsList.appendChild(row);
            });
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµÿ±ŸÅ
        function loadWithdrawals() {
            const withdrawalsList = document.getElementById('withdrawalsList');
            withdrawalsList.innerHTML = '';
            
            if (withdrawals.length === 0) {
                withdrawalsList.innerHTML = '<tr><td colspan="7" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÖŸÑŸäÿßÿ™ ÿµÿ±ŸÅ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                return;
            }
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿµÿ±ŸÅ ŸÖŸÜ ÿßŸÑÿ£ÿ≠ÿØÿ´ ÿ•ŸÑŸâ ÿßŸÑÿ£ŸÇÿØŸÖ
            const sortedWithdrawals = [...withdrawals].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedWithdrawals.forEach(withdrawal => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${withdrawal.date}</td>
                    <td><span class="storage-badge">${withdrawal.storage}</span></td>
                    <td>${withdrawal.product}</td>
                    <td>${withdrawal.quantity}</td>
                    <td>${withdrawal.receiver}</td>
                    <td>${withdrawal.doc || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editWithdrawal(${withdrawal.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${withdrawal.id}, 'withdrawal')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                withdrawalsList.appendChild(row);
            });
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
        function loadUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<tr><td colspan="5" style="text-align: center;">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ ŸÖÿ≥ÿ¨ŸÑŸàŸÜ</td></tr>';
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username} ${user.isAdmin ? '<span class="admin-badge">ŸÖÿØŸäÿ±</span>' : ''}</td>
                    <td>${user.storageUnit}</td>
                    <td>${user.isAdmin ? 'ŸÜÿπŸÖ' : 'ŸÑÿß'}</td>
                    <td>${user.registrationDate || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'}</td>
                    <td class="action-buttons">
                        ${user.username !== currentUser.username ? `
                            <button class="btn btn-admin btn-sm" onclick="editUserPermission('${user.username}')"><i class="fas fa-user-cog"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser('${user.username}')"><i class="fas fa-trash"></i></button>
                        ` : ''}
                    </td>
                `;
                usersList.appendChild(row);
            });
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ
        function loadStorages() {
            const storageList = document.getElementById('storageList');
            const storageSelect = document.getElementById('storageUnit');
            const addStorageSelect = document.getElementById('addStorage');
            const withdrawStorageSelect = document.getElementById('withdrawStorage');
            const inventoryStorageSelect = document.getElementById('inventoryStorage');
            const newStorageUnitSelect = document.getElementById('newStorageUnit');
            
            // ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
            storageList.innerHTML = '';
            storageSelect.innerHTML = '';
            addStorageSelect.innerHTML = '';
            withdrawStorageSelect.innerHTML = '';
            inventoryStorageSelect.innerHTML = '';
            newStorageUnitSelect.innerHTML = '';
            
            if (storages.length === 0) {
                storageList.innerHTML = '<tr><td colspan="5" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿÆÿßÿ≤ŸÜ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿÆÿßÿ≤ŸÜ ŸÖÿ≥ÿ¨ŸÑÿ©';
                storageSelect.appendChild(option);
                return;
            }
            
            // ŸÖŸÑÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ
            storages.forEach(storage => {
                // ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπÿ±ÿ∂
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${storage.name}</td>
                    <td>${storage.location}</td>
                    <td>${storage.manager}</td>
                    <td>${storage.phone}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editStorage(${storage.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteStorage(${storage.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                storageList.appendChild(row);
                
                // ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
                const option = document.createElement('option');
                option.value = storage.name;
                option.textContent = storage.name;
                
                storageSelect.appendChild(option.cloneNode(true));
                addStorageSelect.appendChild(option.cloneNode(true));
                withdrawStorageSelect.appendChild(option.cloneNode(true));
                inventoryStorageSelect.appendChild(option.cloneNode(true));
                newStorageUnitSelect.appendChild(option.cloneNode(true));
            });
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ
        function updateInventory() {
            const inventorySummary = document.getElementById('inventorySummary');
            const lowStockItems = document.getElementById('lowStockItems');
            const selectedStorage = document.getElementById('inventoryStorage').value;
            
            inventorySummary.innerHTML = '';
            lowStockItems.innerHTML = '';
            
            if (products.length === 0) {
                inventorySummary.innerHTML = '<tr><td colspan="6" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿØ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                lowStockItems.innerHTML = '<tr><td colspan="4" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿØ ŸÖŸÜÿÆŸÅÿ∂ÿ©</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const additionsTotal = additions
                    .filter(a => a.product === product.name && (selectedStorage === '' || a.storage === selectedStorage))
                    .reduce((sum, a) => sum + a.quantity, 0);
                
                const withdrawalsTotal = withdrawals
                    .filter(w => w.product === product.name && (selectedStorage === '' || w.storage === selectedStorage))
                    .reduce((sum, w) => sum + w.quantity, 0);
                
                const remaining = additionsTotal - withdrawalsTotal;
                
                let status = 'status-good';
                let statusText = 'ÿ¨ŸäÿØ';
                
                if (remaining <= 0) {
                    status = 'status-danger';
                    statusText = 'ŸÜŸÅÿ∞';
                } else if (remaining <= product.minStock) {
                    status = 'status-warning';
                    statusText = 'ŸÖŸÜÿÆŸÅÿ∂';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${additionsTotal}</td>
                    <td>${withdrawalsTotal}</td>
                    <td>${remaining}</td>
                    <td>${product.minStock}</td>
                    <td class="${status}">${statusText}</td>
                `;
                inventorySummary.appendChild(row);
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑŸÖŸÜÿÆŸÅÿ∂ÿ© ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
                if (remaining <= product.minStock) {
                    const lowStockRow = document.createElement('tr');
                    lowStockRow.innerHTML = `
                        <td>${product.name}</td>
                        <td>${remaining}</td>
                        <td>${product.minStock}</td>
                        <td class="status-danger">${remaining <= 0 ? 'ŸÜŸÅÿ∞' : 'ÿ£ÿ∑ŸÑÿ® ÿ™Ÿàÿ±ŸäÿØ'}</td>
                    `;
                    lowStockItems.appendChild(lowStockRow);
                }
            });
            
            if (lowStockItems.innerHTML === '') {
                lowStockItems.innerHTML = '<tr><td colspan="4" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿØ ŸÖŸÜÿÆŸÅÿ∂ÿ©</td></tr>';
            }
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ¢ÿÆÿ± ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™
        function updateLastTransactions() {
            const lastTransactions = document.getElementById('lastTransactions');
            lastTransactions.innerHTML = '';
            
            // ÿ¨ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ (ÿ•ÿ∂ÿßŸÅÿßÿ™ Ÿàÿµÿ±ŸÅ)
            const allTransactions = [
                ...additions.map(a => ({ ...a, type: 'ÿ•ÿ∂ÿßŸÅÿ©', date: a.date })),
                ...withdrawals.map(w => ({ ...w, type: 'ÿµÿ±ŸÅ', date: w.date }))
            ];
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ŸÖŸÜ ÿßŸÑÿ£ÿ≠ÿØÿ´ ÿ•ŸÑŸâ ÿßŸÑÿ£ŸÇÿØŸÖ
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // ÿ£ÿÆÿ∞ ÿ¢ÿÆÿ± 5 ÿ≠ÿ±ŸÉÿßÿ™
            const recentTransactions = allTransactions.slice(0, 5);
            
            if (recentTransactions.length === 0) {
                lastTransactions.innerHTML = '<tr><td colspan="6" style="text-align: center;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©</td></tr>';
                return;
            }
            
            recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.type}</td>
                    <td>${transaction.product}</td>
                    <td>${transaction.quantity}</td>
                    <td><span class="storage-badge">${transaction.storage}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editTransaction(${transaction.id}, '${transaction.type === 'ÿ•ÿ∂ÿßŸÅÿ©' ? 'addition' : 'withdrawal'}')"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${transaction.id}, '${transaction.type === 'ÿ•ÿ∂ÿßŸÅÿ©' ? 'addition' : 'withdrawal'}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                lastTransactions.appendChild(row);
            });
        }
        
        // ŸÖŸÑÿ° ŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
        function populateProductSelects() {
            const addProductSelect = document.getElementById('addProduct');
            const withdrawProductSelect = document.getElementById('withdrawProduct');
            
            addProductSelect.innerHTML = '';
            withdrawProductSelect.innerHTML = '';
            
            if (products.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿØ ŸÖÿ≥ÿ¨ŸÑÿ©';
                addProductSelect.appendChild(option);
                withdrawProductSelect.appendChild(option.cloneNode(true));
                return;
            }
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.name;
                option.textContent = product.name;
                addProductSelect.appendChild(option);
                withdrawProductSelect.appendChild(option.cloneNode(true));
            });
        }
        
        // ŸÖŸÑÿ° ŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ ŸÅŸä ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
        function populateStorageSelects() {
            const storageSelect = document.getElementById('storageUnit');
            const addStorageSelect = document.getElementById('addStorage');
            const withdrawStorageSelect = document.getElementById('withdrawStorage');
            const inventoryStorageSelect = document.getElementById('inventoryStorage');
            const newStorageUnitSelect = document.getElementById('newStorageUnit');
            
            // ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
            storageSelect.innerHTML = '';
            addStorageSelect.innerHTML = '';
            withdrawStorageSelect.innerHTML = '';
            inventoryStorageSelect.innerHTML = '';
            newStorageUnitSelect.innerHTML = '';
            
            if (storages.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿÆÿßÿ≤ŸÜ ŸÖÿ≥ÿ¨ŸÑÿ©';
                storageSelect.appendChild(option);
                return;
            }
            
            // ŸÖŸÑÿ° ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
            storages.forEach(storage => {
                const option = document.createElement('option');
                option.value = storage.name;
                option.textContent = storage.name;
                
                storageSelect.appendChild(option.cloneNode(true));
                addStorageSelect.appendChild(option.cloneNode(true));
                withdrawStorageSelect.appendChild(option.cloneNode(true));
                inventoryStorageSelect.appendChild(option.cloneNode(true));
                newStorageUnitSelect.appendChild(option.cloneNode(true));
            });
            
            // ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
            if (currentUser.storageUnit) {
                storageSelect.value = currentUser.storageUnit;
            }
        }
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿßÿØÿ© ÿ¨ÿØŸäÿØÿ©
        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const unit = document.getElementById('productUnit').value;
            const minStock = parseInt(document.getElementById('productMinStock').value);
            const category = document.getElementById('productCategory').value;
            const notes = document.getElementById('productNotes').value.trim();
            
            if (!name || isNaN(minStock) || minStock < 0) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿßÿ≥ŸÖ ÿ∫Ÿäÿ± ŸÖŸÉÿ±ÿ±
            if (products.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                alert('Ÿáÿ∞Ÿá ÿßŸÑŸÖÿßÿØÿ© ŸÖÿ≥ÿ¨ŸÑÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã');
                return;
            }
            
            const newProduct = {
                id: Date.now(), // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ∑ÿßÿ®ÿπ ÿßŸÑÿ≤ŸÖŸÜŸä ŸÉŸÖÿπÿ±ŸÅ ŸÅÿ±ŸäÿØ
                name,
                unit,
                minStock,
                category,
                notes
            };
            
            products.push(newProduct);
            saveData();
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ
            document.getElementById('productName').value = '';
            document.getElementById('productMinStock').value = '';
            document.getElementById('productNotes').value = '';
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            loadProducts();
            populateProductSelects();
            updateStats();
            updateInventory();
            
            alert('ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿßÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
        }
        
        // ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ±ŸÉÿ© ÿ•ÿ∂ÿßŸÅÿ©
        function addAddition() {
            const date = document.getElementById('addDate').value;
            const storage = document.getElementById('addStorage').value;
            const product = document.getElementById('addProduct').value;
            const quantity = parseInt(document.getElementById('addQuantity').value);
            const price = parseFloat(document.getElementById('addPrice').value);
            const supplier = document.getElementById('addSupplier').value.trim();
            const doc = document.getElementById('addDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || isNaN(price) || price < 0 || !supplier) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            const newAddition = {
                id: Date.now(),
                date,
                storage,
                product,
                quantity,
                price,
                supplier,
                doc: doc || '-'
            };
            
            additions.push(newAddition);
            saveData();
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ
            document.getElementById('addQuantity').value = '';
            document.getElementById('addPrice').value = '';
            document.getElementById('addSupplier').value = '';
            document.getElementById('addDoc').value = '';
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            loadAdditions();
            updateStats();
            updateInventory();
            updateLastTransactions();
            
            alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
        }
        
        // ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ±ŸÉÿ© ÿµÿ±ŸÅ
        function addWithdrawal() {
            const date = document.getElementById('withdrawDate').value;
            const storage = document.getElementById('withdrawStorage').value;
            const product = document.getElementById('withdrawProduct').value;
            const quantity = parseInt(document.getElementById('withdrawQuantity').value);
            const receiver = document.getElementById('withdrawReceiver').value.trim();
            const doc = document.getElementById('withdrawDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || !receiver) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÉŸÖŸäÿ© ŸÉÿßŸÅŸäÿ© ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ
            const additionsTotal = additions
                .filter(a => a.product === product && a.storage === storage)
                .reduce((sum, a) => sum + a.quantity, 0);
            
            const withdrawalsTotal = withdrawals
                .filter(w => w.product === product && w.storage === storage)
                .reduce((sum, w) => sum + w.quantity, 0);
            
            const remaining = additionsTotal - withdrawalsTotal;
            
            if (quantity > remaining) {
                alert(`ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© (${quantity}) ÿ™ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© (${remaining}) ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑŸÖÿ≠ÿØÿØ`);
                return;
            }
            
            const newWithdrawal = {
                id: Date.now(),
                date,
                storage,
                product,
                quantity,
                receiver,
                doc: doc || '-'
            };
            
            withdrawals.push(newWithdrawal);
            saveData();
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ
            document.getElementById('withdrawQuantity').value = '';
            document.getElementById('withdrawReceiver').value = '';
            document.getElementById('withdrawDoc').value = '';
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            loadWithdrawals();
            updateStats();
            updateInventory();
            updateLastTransactions();
            
            alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµÿ±ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠!');
        }
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿÆÿ≤ŸÜ ÿ¨ÿØŸäÿØ
        function addStorage() {
            const name = document.getElementById('storageName').value.trim();
            const location = document.getElementById('storageLocation').value.trim();
            const manager = document.getElementById('storageManager').value.trim();
            const phone = document.getElementById('storagePhone').value.trim();
            
            if (!name || !location || !manager) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                return;
            }
            
            // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿ∫Ÿäÿ± ŸÖŸÉÿ±ÿ±
            if (storages.some(s => s.name.toLowerCase() === name.toLowerCase())) {
                alert('Ÿáÿ∞ÿß ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÖÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                return;
            }
            
            const newStorage = {
                id: Date.now(),
                name,
                location,
                manager,
                phone
            };
            
            storages.push(newStorage);
            saveData();
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ
            document.getElementById('storageName').value = '';
            document.getElementById('storageLocation').value = '';
            document.getElementById('storageManager').value = '';
            document.getElementById('storagePhone').value = '';
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            loadStorages();
            populateStorageSelects();
            
            alert('ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿ®ŸÜÿ¨ÿßÿ≠!');
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä localStorage
        function saveData() {
            localStorage.setItem('construction_products', JSON.stringify(products));
            localStorage.setItem('construction_additions', JSON.stringify(additions));
            localStorage.setItem('construction_withdrawals', JSON.stringify(withdrawals));
            localStorage.setItem('construction_users', JSON.stringify(users));
            localStorage.setItem('construction_storages', JSON.stringify(storages));
        }
        
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿßÿØÿ©
        function searchProduct() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (searchTerm.length < 1) {
                resultsDiv.innerHTML = '<p>ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖ ŸÖÿßÿØÿ© ŸÅŸä ŸÖÿ±ÿ®ÿπ ÿßŸÑÿ®ÿ≠ÿ´ ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨</p>';
                return;
            }
            
            const foundProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm)
            );
            
            if (foundProducts.length === 0) {
                resultsDiv.innerHTML = '<p class="alert alert-info">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÑŸÑÿ®ÿ≠ÿ´. ÿ≠ÿßŸàŸÑ ÿ®ŸÉŸÑŸÖÿßÿ™ ÿ£ÿÆÿ±Ÿâ.</p>';
                return;
            }
            
            let resultsHTML = '<table><thead><tr><th>ÿßŸÑŸÖÿßÿØÿ©</th><th>ÿßŸÑŸàÿ≠ÿØÿ©</th><th>ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</th><th>ÿßŸÑÿ≠ÿßŸÑÿ©</th></tr></thead><tbody>';
            
            foundProducts.forEach(product => {
                const additionsTotal = additions
                    .filter(a => a.product === product.name)
                    .reduce((sum, a) => sum + a.quantity, 0);
                
                const withdrawalsTotal = withdrawals
                    .filter(w => w.product === product.name)
                    .reduce((sum, w) => sum + w.quantity, 0);
                
                const remaining = additionsTotal - withdrawalsTotal;
                
                let status = 'status-good';
                let statusText = 'ÿ¨ŸäÿØ';
                
                if (remaining <= 0) {
                    status = 'status-danger';
                    statusText = 'ŸÜŸÅÿ∞';
                } else if (remaining <= product.minStock) {
                    status = 'status-warning';
                    statusText = 'ŸÖŸÜÿÆŸÅÿ∂';
                }
                
                resultsHTML += `
                    <tr>
                        <td>${product.name}</td>
                        <td>${product.unit}</td>
                        <td>${remaining}</td>
                        <td class="${status}">${statusText}</td>
                    </tr>
                `;
            });
            
            resultsHTML += '</tbody></table>';
            resultsDiv.innerHTML = resultsHTML;
        }
        
        // ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ
        function confirmDelete(id, type) {
            itemToDelete = id;
            itemTypeToDelete = type;
            
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            message.innerHTML = `ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅÿü<br><strong>Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.</strong>`;
            
            modal.style.display = 'block';
        }
        
        // ÿ™ÿ£ŸÉŸäÿØ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function confirmDeleteUser(username) {
            itemToDelete = username;
            itemTypeToDelete = 'user';
            
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            message.innerHTML = `ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ "${username}"ÿü<br><strong>Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.</strong>`;
            
            modal.style.display = 'block';
        }
        
        // ÿ™ÿ£ŸÉŸäÿØ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿÆÿ≤ŸÜ
        function confirmDeleteStorage(id) {
            itemToDelete = id;
            itemTypeToDelete = 'storage';
            
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            message.innerHTML = `ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿÆÿ≤ŸÜÿü<br><strong>Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.</strong>`;
            
            modal.style.display = 'block';
        }
        
        // ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ≠ÿ∞ŸÅ
        function deleteItem() {
            if (itemTypeToDelete === 'product') {
                // ÿ≠ÿ∞ŸÅ ŸÖÿßÿØÿ©
                const productIndex = products.findIndex(p => p.id === itemToDelete);
                if (productIndex !== -1) {
                    const productName = products[productIndex].name;
                    
                    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÑŸáÿ∞Ÿá ÿßŸÑŸÖÿßÿØÿ©
                    const hasAdditions = additions.some(a => a.product === productName);
                    const hasWithdrawals = withdrawals.some(w => w.product === productName);
                    
                    if (hasAdditions || hasWithdrawals) {
                        alert('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿßÿØÿ© ŸÑÿ£ŸÜŸáÿß ŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿ®ÿ≠ÿ±ŸÉÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©. ŸäŸÖŸÉŸÜŸÉ ÿ™ÿπÿ∑ŸäŸÑŸáÿß ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿ∞ŸÑŸÉ.');
                        closeModal('deleteModal');
                        return;
                    }
                    
                    products.splice(productIndex, 1);
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿßÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
                }
            } else if (itemTypeToDelete === 'addition') {
                // ÿ≠ÿ∞ŸÅ ÿ•ÿ∂ÿßŸÅÿ©
                additions = additions.filter(a => a.id !== itemToDelete);
                alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
            } else if (itemTypeToDelete === 'withdrawal') {
                // ÿ≠ÿ∞ŸÅ ÿµÿ±ŸÅ
                withdrawals = withdrawals.filter(w => w.id !== itemToDelete);
                alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ≥ÿ¨ŸÑ ÿßŸÑÿµÿ±ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠!');
            } else if (itemTypeToDelete === 'user') {
                // ÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ™ÿÆÿØŸÖ
                users = users.filter(u => u.username !== itemToDelete);
                alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!');
            } else if (itemTypeToDelete === 'storage') {
                // ÿ≠ÿ∞ŸÅ ŸÖÿÆÿ≤ŸÜ
                const storageIndex = storages.findIndex(s => s.id === itemToDelete);
                if (storageIndex !== -1) {
                    const storageName = storages[storageIndex].name;
                    
                    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÑŸáÿ∞ÿß ÿßŸÑŸÖÿÆÿ≤ŸÜ
                    const hasAdditions = additions.some(a => a.storage === storageName);
                    const hasWithdrawals = withdrawals.some(w => w.storage === storageName);
                    
                    if (hasAdditions || hasWithdrawals) {
                        alert('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÑÿ£ŸÜŸá ŸÖÿ±ÿ™ÿ®ÿ∑ ÿ®ÿ≠ÿ±ŸÉÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©.');
                        closeModal('deleteModal');
                        return;
                    }
                    
                    storages.splice(storageIndex, 1);
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿ®ŸÜÿ¨ÿßÿ≠!');
                }
            }
            
            saveData();
            closeModal('deleteModal');
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            loadProducts();
            loadAdditions();
            loadWithdrawals();
            loadUsers();
            loadStorages();
            populateProductSelects();
            populateStorageSelects();
            updateStats();
            updateInventory();
            updateLastTransactions();
        }
        
        // ÿ™ÿπÿØŸäŸÑ ŸÖÿßÿØÿ©
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿßÿØÿ©: ${product.name}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editProductName">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©</label>
                    <input type="text" id="editProductName" value="${product.name}" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©">
                </div>
                <div class="form-group">
                    <label for="editProductUnit">ÿßŸÑŸàÿ≠ÿØÿ©</label>
                    <select id="editProductUnit">
                        <option value="ŸÉÿ¨ŸÖ" ${product.unit === 'ŸÉÿ¨ŸÖ' ? 'selected' : ''}>ŸÉÿ¨ŸÖ</option>
                        <option value="ÿ¥ŸäŸÉÿßÿ±ÿ©" ${product.unit === 'ÿ¥ŸäŸÉÿßÿ±ÿ©' ? 'selected' : ''}>ÿ¥ŸäŸÉÿßÿ±ÿ©</option>
                        <option value="ÿ∑ŸÜ" ${product.unit === 'ÿ∑ŸÜ' ? 'selected' : ''}>ÿ∑ŸÜ</option>
                        <option value="ŸÖÿ™ÿ±" ${product.unit === 'ŸÖÿ™ÿ±' ? 'selected' : ''}>ŸÖÿ™ÿ±</option>
                        <option value="ŸÖÿ™ÿ± ŸÖŸÉÿπÿ®" ${product.unit === 'ŸÖÿ™ÿ± ŸÖŸÉÿπÿ®' ? 'selected' : ''}>ŸÖÿ™ÿ± ŸÖŸÉÿπÿ®</option>
                        <option value="ŸÑÿ™ÿ±" ${product.unit === 'ŸÑÿ™ÿ±' ? 'selected' : ''}>ŸÑÿ™ÿ±</option>
                        <option value="ÿπŸÑÿ®ÿ©" ${product.unit === 'ÿπŸÑÿ®ÿ©' ? 'selected' : ''}>ÿπŸÑÿ®ÿ©</option>
                        <option value="ŸÉŸäÿ≥" ${product.unit === 'ŸÉŸäÿ≥' ? 'selected' : ''}>ŸÉŸäÿ≥</option>
                        <option value="ŸÇÿ∑ÿπÿ©" ${product.unit === 'ŸÇÿ∑ÿπÿ©' ? 'selected' : ''}>ŸÇÿ∑ÿπÿ©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductMinStock">ÿ≠ÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∑ŸÑÿ®</label>
                    <input type="number" id="editProductMinStock" value="${product.minStock}" placeholder="ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑŸÖÿÆÿ≤ŸàŸÜ">
                </div>
                <div class="form-group">
                    <label for="editProductCategory">ÿßŸÑŸÅÿ¶ÿ©</label>
                    <select id="editProductCategory">
                        <option value="ŸÖŸàÿßÿØ ÿ®ŸÜÿßÿ°" ${product.category === 'ŸÖŸàÿßÿØ ÿ®ŸÜÿßÿ°' ? 'selected' : ''}>ŸÖŸàÿßÿØ ÿ®ŸÜÿßÿ°</option>
                        <option value="ÿØŸáÿßŸÜÿßÿ™" ${product.category === 'ÿØŸáÿßŸÜÿßÿ™' ? 'selected' : ''}>ÿØŸáÿßŸÜÿßÿ™</option>
                        <option value="ÿ£ÿØŸàÿßÿ™" ${product.category === 'ÿ£ÿØŸàÿßÿ™' ? 'selected' : ''}>ÿ£ÿØŸàÿßÿ™</option>
                        <option value="ŸÉŸáÿ±ÿ®ÿßÿ°" ${product.category === 'ŸÉŸáÿ±ÿ®ÿßÿ°' ? 'selected' : ''}>ŸÉŸáÿ±ÿ®ÿßÿ°</option>
                        <option value="ÿ≥ÿ®ÿßŸÉÿ©" ${product.category === 'ÿ≥ÿ®ÿßŸÉÿ©' ? 'selected' : ''}>ÿ≥ÿ®ÿßŸÉÿ©</option>
                        <option value="ÿ£ÿÆÿ±Ÿâ" ${product.category === 'ÿ£ÿÆÿ±Ÿâ' ? 'selected' : ''}>ÿ£ÿÆÿ±Ÿâ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                    <input type="text" id="editProductNotes" value="${product.notes || ''}" placeholder="ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©">
                </div>
                <button class="btn btn-success btn-full" onclick="saveProduct(${id})"><i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ ÿπŸÑŸâ ÿßŸÑŸÖÿßÿØÿ©
        function saveProduct(id) {
            const name = document.getElementById('editProductName').value.trim();
            const unit = document.getElementById('editProductUnit').value;
            const minStock = parseInt(document.getElementById('editProductMinStock').value);
            const category = document.getElementById('editProductCategory').value;
            const notes = document.getElementById('editProductNotes').value.trim();
            
            if (!name || isNaN(minStock) || minStock < 0) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            const index = products.findIndex(p => p.id === id);
            if (index !== -1) {
                // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿßÿ≥ŸÖÿå ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
                if (name !== products[index].name && products.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                    alert('Ÿáÿ∞ÿß ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                    return;
                }
                
                products[index] = { ...products[index], name, unit, minStock, category, notes };
                saveData();
                alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿßÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
                closeModal('editModal');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                loadProducts();
                populateProductSelects();
                updateInventory();
            }
        }
        
        // ÿ™ÿπÿØŸäŸÑ ÿ•ÿ∂ÿßŸÅÿ©
        function editAddition(id) {
            const addition = additions.find(a => a.id === id);
            if (!addition) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©: ${addition.product}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editAddDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                    <input type="date" id="editAddDate" value="${addition.date}">
                </div>
                <div class="form-group">
                    <label for="editAddStorage">ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <select id="editAddStorage">
                        ${storages.map(s => `<option value="${s.name}" ${s.name === addition.storage ? 'selected' : ''}>${s.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editAddProduct">ÿßŸÑŸÖÿßÿØÿ©</label>
                    <select id="editAddProduct">
                        ${products.map(p => `<option value="${p.name}" ${p.name === addition.product ? 'selected' : ''}>${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editAddQuantity">ÿßŸÑŸÉŸÖŸäÿ©</label>
                    <input type="number" id="editAddQuantity" value="${addition.quantity}" placeholder="ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∂ÿßŸÅÿ©">
                </div>
                <div class="form-group">
                    <label for="editAddPrice">ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ©</label>
                    <input type="number" id="editAddPrice" value="${addition.price}" placeholder="ÿ≥ÿπÿ± ÿßŸÑŸàÿ≠ÿØÿ©" step="0.01">
                </div>
                <div class="form-group">
                    <label for="editAddSupplier">ÿßŸÑŸÖŸàÿ±ÿØ</label>
                    <input type="text" id="editAddSupplier" value="${addition.supplier}" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ±ÿØ">
                </div>
                <div class="form-group">
                    <label for="editAddDoc">ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ</label>
                    <input type="text" id="editAddDoc" value="${addition.doc}" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ">
                </div>
                <button class="btn btn-success btn-full" onclick="saveAddition(${id})"><i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
        function saveAddition(id) {
            const date = document.getElementById('editAddDate').value;
            const storage = document.getElementById('editAddStorage').value;
            const product = document.getElementById('editAddProduct').value;
            const quantity = parseInt(document.getElementById('editAddQuantity').value);
            const price = parseFloat(document.getElementById('editAddPrice').value);
            const supplier = document.getElementById('editAddSupplier').value.trim();
            const doc = document.getElementById('editAddDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || isNaN(price) || price < 0 || !supplier) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            const index = additions.findIndex(a => a.id === id);
            if (index !== -1) {
                additions[index] = { ...additions[index], date, storage, product, quantity, price, supplier, doc: doc || '-' };
                saveData();
                alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠!');
                closeModal('editModal');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                loadAdditions();
                updateStats();
                updateInventory();
                updateLastTransactions();
            }
        }
        
        // ÿ™ÿπÿØŸäŸÑ ÿµÿ±ŸÅ
        function editWithdrawal(id) {
            const withdrawal = withdrawals.find(w => w.id === id);
            if (!withdrawal) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿµÿ±ŸÅ: ${withdrawal.product}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editWithdrawDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                    <input type="date" id="editWithdrawDate" value="${withdrawal.date}">
                </div>
                <div class="form-group">
                    <label for="editWithdrawStorage">ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <select id="editWithdrawStorage">
                        ${storages.map(s => `<option value="${s.name}" ${s.name === withdrawal.storage ? 'selected' : ''}>${s.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editWithdrawProduct">ÿßŸÑŸÖÿßÿØÿ©</label>
                    <select id="editWithdrawProduct">
                        ${products.map(p => `<option value="${p.name}" ${p.name === withdrawal.product ? 'selected' : ''}>${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editWithdrawQuantity">ÿßŸÑŸÉŸÖŸäÿ©</label>
                    <input type="number" id="editWithdrawQuantity" value="${withdrawal.quantity}" placeholder="ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿ©">
                </div>
                <div class="form-group">
                    <label for="editWithdrawReceiver">ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ/ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</label>
                    <input type="text" id="editWithdrawReceiver" value="${withdrawal.receiver}" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ ÿ£Ÿà ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ">
                </div>
                <div class="form-group">
                    <label for="editWithdrawDoc">ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ</label>
                    <input type="text" id="editWithdrawDoc" value="${withdrawal.doc}" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ">
                </div>
                <button class="btn btn-success btn-full" onclick="saveWithdrawal(${id})"><i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿµÿ±ŸÅ
        function saveWithdrawal(id) {
            const date = document.getElementById('editWithdrawDate').value;
            const storage = document.getElementById('editWithdrawStorage').value;
            const product = document.getElementById('editWithdrawProduct').value;
            const quantity = parseInt(document.getElementById('editWithdrawQuantity').value);
            const receiver = document.getElementById('editWithdrawReceiver').value.trim();
            const doc = document.getElementById('editWithdrawDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || !receiver) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÉŸÖŸäÿ© ŸÉÿßŸÅŸäÿ© ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ (ÿ®ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©)
            const additionsTotal = additions
                .filter(a => a.product === product && a.storage === storage)
                .reduce((sum, a) => sum + a.quantity, 0);
            
            const currentWithdrawal = withdrawals.find(w => w.id === id);
            const otherWithdrawalsTotal = withdrawals
                .filter(w => w.product === product && w.storage === storage && w.id !== id)
                .reduce((sum, w) => sum + w.quantity, 0);
            
            const remaining = additionsTotal - otherWithdrawalsTotal;
            
            if (quantity > remaining) {
                alert(`ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© (${quantity}) ÿ™ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© (${remaining}) ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑŸÖÿ≠ÿØÿØ`);
                return;
            }
            
            const index = withdrawals.findIndex(w => w.id === id);
            if (index !== -1) {
                withdrawals[index] = { ...withdrawals[index], date, storage, product, quantity, receiver, doc: doc || '-' };
                saveData();
                alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµÿ±ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠!');
                closeModal('editModal');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                loadWithdrawals();
                updateStats();
                updateInventory();
                updateLastTransactions();
            }
        }
        
        // ÿ™ÿπÿØŸäŸÑ ŸÖÿÆÿ≤ŸÜ
        function editStorage(id) {
            const storage = storages.find(s => s.id === id);
            if (!storage) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖÿÆÿ≤ŸÜ: ${storage.name}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editStorageName">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <input type="text" id="editStorageName" value="${storage.name}" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿÆÿ≤ŸÜ">
                </div>
                <div class="form-group">
                    <label for="editStorageLocation">ÿßŸÑŸÖŸàŸÇÿπ</label>
                    <input type="text" id="editStorageLocation" value="${storage.location}" placeholder="ŸÖŸàŸÇÿπ ÿßŸÑŸÖÿÆÿ≤ŸÜ">
                </div>
                <div class="form-group">
                    <label for="editStorageManager">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                    <input type="text" id="editStorageManager" value="${storage.manager}" placeholder="ÿßÿ≥ŸÖ ŸÖÿ≥ÿ§ŸàŸÑ ÿßŸÑŸÖÿÆÿ≤ŸÜ">
                </div>
                <div class="form-group">
                    <label for="editStoragePhone">Ÿáÿßÿ™ŸÅ ÿßŸÑŸÖÿÆÿ≤ŸÜ</label>
                    <input type="text" id="editStoragePhone" value="${storage.phone}" placeholder="Ÿáÿßÿ™ŸÅ ÿßŸÑÿßÿ™ÿµÿßŸÑ">
                </div>
                <button class="btn btn-success btn-full" onclick="saveStorage(${id})"><i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ ÿπŸÑŸâ ÿßŸÑŸÖÿÆÿ≤ŸÜ
        function saveStorage(id) {
            const name = document.getElementById('editStorageName').value.trim();
            const location = document.getElementById('editStorageLocation').value.trim();
            const manager = document.getElementById('editStorageManager').value.trim();
            const phone = document.getElementById('editStoragePhone').value.trim();
            
            if (!name || !location || !manager) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                return;
            }
            
            const index = storages.findIndex(s => s.id === id);
            if (index !== -1) {
                // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿßÿ≥ŸÖÿå ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
                if (name !== storages[index].name && storages.some(s => s.name.toLowerCase() === name.toLowerCase())) {
                    alert('Ÿáÿ∞ÿß ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                    return;
                }
                
                storages[index] = { ...storages[index], name, location, manager, phone };
                saveData();
                alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿ®ŸÜÿ¨ÿßÿ≠!');
                closeModal('editModal');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                loadStorages();
                populateStorageSelects();
            }
        }
        
        // ÿ™ÿπÿØŸäŸÑ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function editUserPermission(username) {
            const user = users.find(u => u.username === username);
            if (!user) return;
            
            userToEdit = username;
            
            const modal = document.getElementById('permissionModal');
            const title = document.getElementById('permissionModalTitle');
            const permissionSelect = document.getElementById('userPermission');
            
            title.textContent = `ÿ™ÿ∫ŸäŸäÿ± ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: ${username}`;
            permissionSelect.value = user.isAdmin ? 'admin' : 'user';
            
            modal.style.display = 'block';
        }
        
        // ÿ≠ŸÅÿ∏ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function saveUserPermission() {
            if (!userToEdit) return;
            
            const permission = document.getElementById('userPermission').value;
            const isAdmin = permission === 'admin';
            
            const index = users.findIndex(u => u.username === userToEdit);
            if (index !== -1) {
                users[index].isAdmin = isAdmin;
                saveData();
                alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!');
                closeModal('permissionModal');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                loadUsers();
            }
        }
        
        // ÿ™ÿπÿØŸäŸÑ ÿ≠ÿ±ŸÉÿ© (ŸÑŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä)
        function editTransaction(id, type) {
            if (type === 'addition') {
                editAddition(id);
            } else {
                editWithdrawal(id);
            }
        }
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            userToEdit = null;
        }
        
        // ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±
        function printReport() {
            const selectedStorage = document.getElementById('inventoryStorage').value;
            const storageTitle = selectedStorage ? ` - ${selectedStorage}` : '';
            
            const printContent = `
                <div dir="rtl">
                    <h1 style="text-align: center;">ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ${storageTitle}</h1>
                    <p style="text-align: center;">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±: ${new Date().toLocaleDateString('ar-EG')}</p>
                    <hr>
                    <h2>ŸÖŸÑÿÆÿµ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</h2>
                    ${document.getElementById('inventorySummary').outerHTML}
                    <hr>
                    <h2>ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑŸÖŸÜÿÆŸÅÿ∂ÿ©</h2>
                    ${document.getElementById('lowStockItems').outerHTML}
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                        th, td { padding: 8px; text-align: right; border-bottom: 1px solid #ddd; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>${printContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function exportData() {
            const data = {
                products,
                additions,
                withdrawals,
                users,
                storages
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "construction_data_" + new Date().toISOString().split('T')[0] + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            alert('ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!');
        }
        
        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const storageUnit = document.getElementById('storageUnit').value;
            
            if (!username || !password || !storageUnit) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                return;
            }
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                initSystem();
            } else {
                alert('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©');
            }
        }
        
        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
        function logout() {
            currentUser = null;
            document.getElementById('app').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // ÿπÿ±ÿ∂ ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
        function showRegisterForm() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.remove('hidden');
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿÆŸäÿßÿ± ŸÖŸÜÿ≠ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿØŸäÿ± ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿØŸäÿ±ŸäŸÜ
            if (currentUser && currentUser.isAdmin) {
                document.getElementById('adminCheckboxContainer').style.display = 'block';
            }
        }
        
        // ÿπÿ±ÿ∂ ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        function showLoginForm() {
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }
        
        // ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ
        function register() {
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const storageUnit = document.getElementById('newStorageUnit').value;
            const isAdmin = document.getElementById('isAdmin') ? document.getElementById('isAdmin').checked : false;
            
            if (!username || !password || !confirmPassword || !storageUnit) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ©');
                return;
            }
            
            if (users.some(u => u.username === username)) {
                alert('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                return;
            }
            
            const newUser = {
                username,
                password,
                storageUnit,
                isAdmin,
                registrationDate: new Date().toLocaleDateString('ar-EG')
            };
            
            users.push(newUser);
            saveData();
            
            alert('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠! ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ');
            showLoginForm();
        }
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let i = 0; i < modals.length; i++) {
                if (event.target == modals[i]) {
                    modals[i].style.display = 'none';
                    userToEdit = null;
                }
            }
        };
        
        // ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑÿµŸÅÿ≠ÿßÿ™
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            const tabButtons = document.getElementsByClassName('tab');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸäÿ≥ ŸÖÿØŸäÿ±ÿßŸãÿå ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ÿßŸÑÿÆÿßÿµÿ© ÿ®ÿßŸÑŸÖÿØŸäÿ±
            if ((tabName === 'users' || tabName === 'storage') && (!currentUser || !currentUser.isAdmin)) {
                alert('Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ŸÖÿ™ÿßÿ≠ÿ© ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿØŸäÿ±ŸäŸÜ');
                document.getElementById(tabName).classList.remove('active');
                document.getElementById('main').classList.add('active');
                
                const tab = document.querySelector(`.tab[onclick="openTab('${tabName}')"]`);
                if (tab) tab.classList.remove('active');
                
                document.querySelector('.tab[onclick="openTab(\'main\')"]').classList.add('active');
            }
        }
        
        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        window.onload = function() {
            // ŸÖŸÑÿ° ŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
            const storageUnitSelect = document.getElementById('storageUnit');
            const newStorageUnitSelect = document.getElementById('newStorageUnit');
            
            storages.forEach(storage => {
                const option = document.createElement('option');
                option.value = storage.name;
                option.textContent = storage.name;
                
                storageUnitSelect.appendChild(option.cloneNode(true));
                newStorageUnitSelect.appendChild(option.cloneNode(true));
            });
        };
    </script>
</body>
</html>