<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ—ï¸</text></svg>">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --edit: #9b59b6;
            --admin: #d35400;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background-color: var(--light);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 12px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark);
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-box {
            background: var(--light);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #777;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        th, td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            margin: 5px 0;
            transition: background 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-edit {
            background-color: var(--edit);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-admin {
            background-color: var(--admin);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-good {
            color: var(--success);
            font-weight: 600;
        }
        
        .status-warning {
            color: var(--warning);
            font-weight: 600;
        }
        
        .status-danger {
            color: var(--danger);
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            animation: modalFade 0.3s;
        }
        
        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .hidden {
            display: none;
        }
        
        .github-info {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        
        .admin-badge {
            background: var(--admin);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .storage-badge {
            background: var(--secondary);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 0 5px;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 900px;
            }
            
            .stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .btn {
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="github-info">
        <h3>ğŸ—ï¸ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©</h3>
        <p>ØªÙ… Ø§Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØªØ·ÙˆÙŠØ±Ù‡ Ø¨ÙŠ ÙˆØ§Ø³Ø·Ø© Ù…Ø­Ù…Ø¯ Ø±Ø´Ø§Ø¯  | Hamo</p>
    </div>

    <div id="loginPage" class="login-container">
        <h2 class="login-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„  ğŸ”¥</h2>
        <div class="form-group">
            <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <input type="text" id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        </div>
        <div class="form-group">
            <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <div class="form-group">
            <label for="storageUnit">Ø§Ù„Ù…Ø®Ø²Ù†</label>
            <select id="storageUnit">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </select>
        </div>
        <button class="btn btn-full" onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <p style="text-align: center; margin-top: 15px;">
            Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showRegisterForm()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
        </p>
        
        <div class="alert alert-info" style="margin-top: 20px;">
            <strong>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ù‡ Ù„Ø¯ÙŠ </strong><br>
            Ù…Ø­Ù…Ø¯ Ø±Ø´Ø§Ø¯|: hamo<br>
             
        </div>
    </div>

    <div id="registerPage" class="login-container hidden">
        <h2 class="login-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
        <div class="form-group">
            <label for="newUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <input type="text" id="newUsername" placeholder="Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        </div>
        <div class="form-group">
            <label for="newPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="newPassword" placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <div class="form-group">
            <label for="confirmPassword">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="confirmPassword" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <div class="form-group">
            <label for="newStorageUnit">Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
            <select id="newStorageUnit">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </select>
        </div>
        <div class="form-group" id="adminCheckboxContainer" style="display: none;">
            <label>
                <input type="checkbox" id="isAdmin"> Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
            </label>
        </div>
        <button class="btn btn-full" onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <p style="text-align: center; margin-top: 15px;">
            Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="#" onclick="showLoginForm()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        </p>
    </div>

    <div id="app" class="container hidden">
        <header>
            <div>
                <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©</h1>
                <div class="subtitle" id="storageUnitName">Ø§Ù„Ù…Ø®Ø²Ù†: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
            <div class="user-info">
                <span id="currentUser">
                    <span id="userDisplayName">Ù…Ø³ØªØ®Ø¯Ù…</span>
                    <span id="adminBadge" class="admin-badge hidden">Ù…Ø¯ÙŠØ±</span>
                </span>
                <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab('main')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="tab" onclick="openTab('products')">Ø§Ù„Ù…ÙˆØ§Ø¯</button>
            <button class="tab" onclick="openTab('additions')">Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</button>
            <button class="tab" onclick="openTab('withdrawals')">Ø§Ù„ØµØ±Ù</button>
            <button class="tab" onclick="openTab('inventory')">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
            <button class="tab" onclick="openTab('users')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            <button class="tab" onclick="openTab('storage')" id="storageTab">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù†</button>
        </div>
        
        <div id="main" class="tab-content active">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            
            <input type="text" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø© (Ù…Ø«Ø§Ù„: Ø£Ø³Ù…Ù†Øª)" onkeyup="searchProduct()" id="searchInput">
            
            <div class="card">
                <div class="card-title">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</div>
                <div id="searchResults">
                    <p>Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø§Ø¯Ø© ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalAdditions">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalWithdrawals">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ±Ù</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="lowStock">0</div>
                    <div class="stat-label">Ù…ÙˆØ§Ø¯ Ù…Ù†Ø®ÙØ¶Ø©</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©</th>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ø®Ø²Ù†</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="lastTransactions">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="products" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</h2>
            
            <div class="alert alert-info">
                Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…ÙˆØ§Ø¯ ÙÙŠ Ø§Ù„Ù…Ø®Ø§Ø²Ù†
            </div>
            
            <div class="card">
                <div class="card-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
                <div class="form-group">
                    <label for="productName">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="productName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø³Ù…Ù†Øª">
                </div>
                <div class="form-group">
                    <label for="productUnit">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select id="productUnit">
                        <option value="ÙƒØ¬Ù…">ÙƒØ¬Ù…</option>
                        <option value="Ø´ÙŠÙƒØ§Ø±Ø©">Ø´ÙŠÙƒØ§Ø±Ø©</option>
                        <option value="Ø·Ù†">Ø·Ù†</option>
                        <option value="Ù…ØªØ±">Ù…ØªØ±</option>
                        <option value="Ù…ØªØ± Ù…ÙƒØ¹Ø¨">Ù…ØªØ± Ù…ÙƒØ¹Ø¨</option>
                        <option value="Ù„ØªØ±">Ù„ØªØ±</option>
                        <option value="Ø¹Ù„Ø¨Ø©">Ø¹Ù„Ø¨Ø©</option>
                        <option value="ÙƒÙŠØ³">ÙƒÙŠØ³</option>
                        <option value="Ù‚Ø·Ø¹Ø©">Ù‚Ø·Ø¹Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productMinStock">Ø­Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨</label>
                    <input type="number" id="productMinStock" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†">
                </div>
                <div class="form-group">
                    <label for="productCategory">Ø§Ù„ÙØ¦Ø©</label>
                    <select id="productCategory">
                        <option value="Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡">Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡</option>
                        <option value="Ø¯Ù‡Ø§Ù†Ø§Øª">Ø¯Ù‡Ø§Ù†Ø§Øª</option>
                        <option value="Ø£Ø¯ÙˆØ§Øª">Ø£Ø¯ÙˆØ§Øª</option>
                        <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                        <option value="Ø³Ø¨Ø§ÙƒØ©">Ø³Ø¨Ø§ÙƒØ©</option>
                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <input type="text" id="productNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                </div>
                <button class="btn btn-success" onclick="addProduct()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø©</button>
            </div>
            
            <div class="card">
                <div class="card-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                            <th>Ø§Ù„ÙØ¦Ø©</th>
                            <th>Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="productsList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="additions" class="tab-content">
            <h2>Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</h2>
            
            <div class="card">
                <div class="card-title">ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</div>
                <div class="form-group">
                    <label for="addDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="addDate">
                </div>
                <div class="form-group">
                    <label for="addStorage">Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <select id="addStorage">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="addProduct">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="addProduct">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="addQuantity">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                    <input type="number" id="addQuantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ©">
                </div>
                <div class="form-group">
                    <label for="addPrice">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <input type="number" id="addPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©">
                </div>
                <div class="form-group">
                    <label for="addSupplier">Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                    <input type="text" id="addSupplier" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
                </div>
                <div class="form-group">
                    <label for="addDoc">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>
                    <input type="text" id="addDoc" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯">
                </div>
                <button class="btn btn-success" onclick="addAddition()"><i class="fas fa-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
            </div>
            
            <div class="card">
                <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ù…Ø®Ø²Ù†</th>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                            <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="additionsList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="withdrawals" class="tab-content">
            <h2>Ø³Ø¬Ù„ Ø§Ù„ØµØ±Ù</h2>
            
            <div class="card">
                <div class="card-title">ØªØ³Ø¬ÙŠÙ„ ØµØ±Ù Ø¬Ø¯ÙŠØ¯</div>
                <div class="form-group">
                    <label for="withdrawDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="withdrawDate">
                </div>
                <div class="form-group">
                    <label for="withdrawStorage">Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <select id="withdrawStorage">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="withdrawProduct">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="withdrawProduct">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="withdrawQuantity">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                    <input type="number" id="withdrawQuantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙˆÙØ©">
                </div>
                <div class="form-group">
                    <label for="withdrawReceiver">Ø§Ù„Ù…Ø³ØªÙ„Ù…/Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="text" id="withdrawReceiver" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">
                </div>
                <div class="form-group">
                    <label for="withdrawDoc">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>
                    <input type="text" id="withdrawDoc" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯">
                </div>
                <button class="btn btn-success" onclick="addWithdrawal()"><i class="fas fa-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµØ±Ù</button>
            </div>
            
            <div class="card">
                <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„ØµØ±Ù</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ù…Ø®Ø²Ù†</th>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawalsList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="inventory" class="tab-content">
            <h2>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
            
            <div class="card">
                <div class="card-title">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø®Ø²Ù† Ù„Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ±Ù‡</div>
                <div class="form-group">
                    <select id="inventoryStorage" onchange="updateInventory()">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </select>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</th>
                            <th>Ø§Ù„ØµØ±Ù</th>
                            <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                            <th>Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="inventorySummary">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <div class="card-title">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                            <th>Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="lowStockItems">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <div class="card-title">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</div>
                <button class="btn btn-full" onclick="printReport()"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                <button class="btn btn-full btn-success" onclick="exportData()"><i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
        
        <div id="users" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
            
            <div class="alert alert-info">
                Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†
            </div>
            
            <div class="card">
                <div class="card-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                            <th>Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</th>
                            <th>ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="usersList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="storage" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù†</h2>
            
            <div class="alert alert-info">
                Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†
            </div>
            
            <div class="card">
                <div class="card-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²Ù† Ø¬Ø¯ÙŠØ¯</div>
                <div class="form-group">
                    <label for="storageName">Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <input type="text" id="storageName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø®Ø²Ù† Ø£ÙƒØªÙˆØ¨Ø±">
                </div>
                <div class="form-group">
                    <label for="storageLocation">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <input type="text" id="storageLocation" placeholder="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø®Ø²Ù†">
                </div>
                <div class="form-group">
                    <label for="storageManager">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                    <input type="text" id="storageManager" placeholder="Ø§Ø³Ù… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²Ù†">
                </div>
                <div class="form-group">
                    <label for="storagePhone">Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <input type="text" id="storagePhone" placeholder="Ù‡Ø§ØªÙ Ø§Ù„Ø§ØªØµØ§Ù„">
                </div>
                <button class="btn btn-success" onclick="addStorage()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø²Ù†</button>
            </div>
            
            <div class="card">
                <div class="card-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù†</div>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†</th>
                            <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                            <th>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø®Ø²Ù†</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="storageList">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deleteModal')">&times;</span>
            <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
            <p id="deleteMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-full btn-danger" onclick="deleteItem()">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
                <button class="btn btn-full" onclick="closeModal('deleteModal')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editModal')">&times;</span>
            <h3 id="editModalTitle">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ†Ù</h3>
            <div id="editModalContent">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
    <div id="permissionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('permissionModal')">&times;</span>
            <h3 id="permissionModalTitle">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
            <div class="form-group">
                <label for="userPermission">ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                <select id="userPermission">
                    <option value="user">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
                    <option value="admin">Ù…Ø¯ÙŠØ±</option>
                </select>
            </div>
            <button class="btn btn-full btn-admin" onclick="saveUserPermission()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
        let products = JSON.parse(localStorage.getItem('construction_products')) || [];
        let additions = JSON.parse(localStorage.getItem('construction_additions')) || [];
        let withdrawals = JSON.parse(localStorage.getItem('construction_withdrawals')) || [];
        let users = JSON.parse(localStorage.getItem('construction_users')) || [
            { username: 'hamo', password: '205347', storageUnit: 'Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', isAdmin: true, registrationDate: new Date().toLocaleDateString('ar-EG') }
        ];
        let storages = JSON.parse(localStorage.getItem('construction_storages')) || [
            { id: 1, name: 'Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', location: 'Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', manager: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', phone: '01000000000' },
            { id: 2, name: 'Ù…Ø®Ø²Ù† Ø£ÙƒØªÙˆØ¨Ø±', location: 'Ù…Ø¯ÙŠÙ†Ø© 6 Ø£ÙƒØªÙˆØ¨Ø±', manager: 'Ù…Ø³Ø¤ÙˆÙ„ Ø£ÙƒØªÙˆØ¨Ø±', phone: '01111111111' },
            { id: 3, name: 'Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ', location: 'Ù…Ø­Ø§ÙØ¸Ø© Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ', manager: 'Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ', phone: '01222222222' }
        ];
        
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        let currentUser = null;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„Ø­Ø°Ù
        let itemToDelete = null;
        let itemTypeToDelete = null;
        let userToEdit = null;
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        function initSystem() {
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('addDate').value = today;
            document.getElementById('withdrawDate').value = today;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStats();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadProducts();
            loadAdditions();
            loadWithdrawals();
            loadUsers();
            loadStorages();
            updateInventory();
            updateLastTransactions();
            
            // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØµØ±Ù
            populateProductSelects();
            populateStorageSelects();
            
            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙˆØ­Ø¯Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†
            document.getElementById('userDisplayName').textContent = currentUser.username;
            document.getElementById('storageUnitName').textContent = `Ø§Ù„Ù…Ø®Ø²Ù†: ${currentUser.storageUnit}`;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±
            if (currentUser.isAdmin) {
                document.getElementById('adminBadge').classList.remove('hidden');
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ±
            toggleAdminFeatures();
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
        function toggleAdminFeatures() {
            const isAdmin = currentUser.isAdmin;
            
            // ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù†
            if (!isAdmin) {
                document.getElementById('storageTab').style.display = 'none';
            }
            
            // ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            if (!isAdmin) {
                const usersTab = document.querySelector('.tab[onclick="openTab(\'users\')"]');
                if (usersTab) usersTab.style.display = 'none';
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø®ÙŠØ§Ø± Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙÙ‚Ø·
            if (isAdmin) {
                document.getElementById('adminCheckboxContainer').style.display = 'block';
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats() {
            document.getElementById('totalProducts').textContent = products.length;
            
            const totalAdditions = additions.reduce((sum, addition) => sum + addition.quantity, 0);
            document.getElementById('totalAdditions').textContent = totalAdditions;
            
            const totalWithdrawals = withdrawals.reduce((sum, withdrawal) => sum + withdrawal.quantity, 0);
            document.getElementById('totalWithdrawals').textContent = totalWithdrawals;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©
            const lowStockCount = products.filter(product => {
                const additionsTotal = additions
                    .filter(a => a.product === product.name)
                    .reduce((sum, a) => sum + a.quantity, 0);
                
                const withdrawalsTotal = withdrawals
                    .filter(w => w.product === product.name)
                    .reduce((sum, w) => sum + w.quantity, 0);
                
                const remaining = additionsTotal - withdrawalsTotal;
                return remaining <= product.minStock;
            }).length;
            
            document.getElementById('lowStock').textContent = lowStockCount;
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯
        function loadProducts() {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';
            
            if (products.length === 0) {
                productsList.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ø³Ø¬Ù„Ø©</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.unit}</td>
                    <td>${product.category}</td>
                    <td>${product.minStock}</td>
                    <td>${product.notes || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editProduct(${product.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${product.id}, 'product')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                productsList.appendChild(row);
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
        function loadAdditions() {
            const additionsList = document.getElementById('additionsList');
            additionsList.innerHTML = '';
            
            if (additions.length === 0) {
                additionsList.innerHTML = '<tr><td colspan="8" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¶Ø§ÙØ§Øª Ù…Ø³Ø¬Ù„Ø©</td></tr>';
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            const sortedAdditions = [...additions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedAdditions.forEach(addition => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${addition.date}</td>
                    <td><span class="storage-badge">${addition.storage}</span></td>
                    <td>${addition.product}</td>
                    <td>${addition.quantity}</td>
                    <td>${addition.price}</td>
                    <td>${addition.quantity * addition.price}</td>
                    <td>${addition.supplier}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editAddition(${addition.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${addition.id}, 'addition')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                additionsList.appendChild(row);
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµØ±Ù
        function loadWithdrawals() {
            const withdrawalsList = document.getElementById('withdrawalsList');
            withdrawalsList.innerHTML = '';
            
            if (withdrawals.length === 0) {
                withdrawalsList.innerHTML = '<tr><td colspan="7" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª ØµØ±Ù Ù…Ø³Ø¬Ù„Ø©</td></tr>';
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ±Ù Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            const sortedWithdrawals = [...withdrawals].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedWithdrawals.forEach(withdrawal => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${withdrawal.date}</td>
                    <td><span class="storage-badge">${withdrawal.storage}</span></td>
                    <td>${withdrawal.product}</td>
                    <td>${withdrawal.quantity}</td>
                    <td>${withdrawal.receiver}</td>
                    <td>${withdrawal.doc || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editWithdrawal(${withdrawal.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${withdrawal.id}, 'withdrawal')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                withdrawalsList.appendChild(row);
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<tr><td colspan="5" style="text-align: center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ†</td></tr>';
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username} ${user.isAdmin ? '<span class="admin-badge">Ù…Ø¯ÙŠØ±</span>' : ''}</td>
                    <td>${user.storageUnit}</td>
                    <td>${user.isAdmin ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</td>
                    <td>${user.registrationDate || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                    <td class="action-buttons">
                        ${user.username !== currentUser.username ? `
                            <button class="btn btn-admin btn-sm" onclick="editUserPermission('${user.username}')"><i class="fas fa-user-cog"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser('${user.username}')"><i class="fas fa-trash"></i></button>
                        ` : ''}
                    </td>
                `;
                usersList.appendChild(row);
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø²Ù†
        function loadStorages() {
            const storageList = document.getElementById('storageList');
            const storageSelect = document.getElementById('storageUnit');
            const addStorageSelect = document.getElementById('addStorage');
            const withdrawStorageSelect = document.getElementById('withdrawStorage');
            const inventoryStorageSelect = document.getElementById('inventoryStorage');
            const newStorageUnitSelect = document.getElementById('newStorageUnit');
            
            // ØªÙØ±ÙŠØº Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            storageList.innerHTML = '';
            storageSelect.innerHTML = '';
            addStorageSelect.innerHTML = '';
            withdrawStorageSelect.innerHTML = '';
            inventoryStorageSelect.innerHTML = '';
            newStorageUnitSelect.innerHTML = '';
            
            if (storages.length === 0) {
                storageList.innerHTML = '<tr><td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø²Ù† Ù…Ø³Ø¬Ù„Ø©</td></tr>';
                
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø²Ù† Ù…Ø³Ø¬Ù„Ø©';
                storageSelect.appendChild(option);
                return;
            }
            
            // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø§Ø²Ù†
            storages.forEach(storage => {
                // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø±Ø¶
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${storage.name}</td>
                    <td>${storage.location}</td>
                    <td>${storage.manager}</td>
                    <td>${storage.phone}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editStorage(${storage.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDeleteStorage(${storage.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                storageList.appendChild(row);
                
                // Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                const option = document.createElement('option');
                option.value = storage.name;
                option.textContent = storage.name;
                
                storageSelect.appendChild(option.cloneNode(true));
                addStorageSelect.appendChild(option.cloneNode(true));
                withdrawStorageSelect.appendChild(option.cloneNode(true));
                inventoryStorageSelect.appendChild(option.cloneNode(true));
                newStorageUnitSelect.appendChild(option.cloneNode(true));
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        function updateInventory() {
            const inventorySummary = document.getElementById('inventorySummary');
            const lowStockItems = document.getElementById('lowStockItems');
            const selectedStorage = document.getElementById('inventoryStorage').value;
            
            inventorySummary.innerHTML = '';
            lowStockItems.innerHTML = '';
            
            if (products.length === 0) {
                inventorySummary.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ø³Ø¬Ù„Ø©</td></tr>';
                lowStockItems.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ù†Ø®ÙØ¶Ø©</td></tr>';
                return;
            }
            
            products.forEach(product => {
                const additionsTotal = additions
                    .filter(a => a.product === product.name && (selectedStorage === '' || a.storage === selectedStorage))
                    .reduce((sum, a) => sum + a.quantity, 0);
                
                const withdrawalsTotal = withdrawals
                    .filter(w => w.product === product.name && (selectedStorage === '' || w.storage === selectedStorage))
                    .reduce((sum, w) => sum + w.quantity, 0);
                
                const remaining = additionsTotal - withdrawalsTotal;
                
                let status = 'status-good';
                let statusText = 'Ø¬ÙŠØ¯';
                
                if (remaining <= 0) {
                    status = 'status-danger';
                    statusText = 'Ù†ÙØ°';
                } else if (remaining <= product.minStock) {
                    status = 'status-warning';
                    statusText = 'Ù…Ù†Ø®ÙØ¶';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${additionsTotal}</td>
                    <td>${withdrawalsTotal}</td>
                    <td>${remaining}</td>
                    <td>${product.minStock}</td>
                    <td class="${status}">${statusText}</td>
                `;
                inventorySummary.appendChild(row);
                
                // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                if (remaining <= product.minStock) {
                    const lowStockRow = document.createElement('tr');
                    lowStockRow.innerHTML = `
                        <td>${product.name}</td>
                        <td>${remaining}</td>
                        <td>${product.minStock}</td>
                        <td class="status-danger">${remaining <= 0 ? 'Ù†ÙØ°' : 'Ø£Ø·Ù„Ø¨ ØªÙˆØ±ÙŠØ¯'}</td>
                    `;
                    lowStockItems.appendChild(lowStockRow);
                }
            });
            
            if (lowStockItems.innerHTML === '') {
                lowStockItems.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ù†Ø®ÙØ¶Ø©</td></tr>';
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª
        function updateLastTransactions() {
            const lastTransactions = document.getElementById('lastTransactions');
            lastTransactions.innerHTML = '';
            
            // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª (Ø¥Ø¶Ø§ÙØ§Øª ÙˆØµØ±Ù)
            const allTransactions = [
                ...additions.map(a => ({ ...a, type: 'Ø¥Ø¶Ø§ÙØ©', date: a.date })),
                ...withdrawals.map(w => ({ ...w, type: 'ØµØ±Ù', date: w.date }))
            ];
            
            // ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Ø£Ø®Ø° Ø¢Ø®Ø± 5 Ø­Ø±ÙƒØ§Øª
            const recentTransactions = allTransactions.slice(0, 5);
            
            if (recentTransactions.length === 0) {
                lastTransactions.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø©</td></tr>';
                return;
            }
            
            recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.type}</td>
                    <td>${transaction.product}</td>
                    <td>${transaction.quantity}</td>
                    <td><span class="storage-badge">${transaction.storage}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editTransaction(${transaction.id}, '${transaction.type === 'Ø¥Ø¶Ø§ÙØ©' ? 'addition' : 'withdrawal'}')"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete(${transaction.id}, '${transaction.type === 'Ø¥Ø¶Ø§ÙØ©' ? 'addition' : 'withdrawal'}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                lastTransactions.appendChild(row);
            });
        }
        
        // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        function populateProductSelects() {
            const addProductSelect = document.getElementById('addProduct');
            const withdrawProductSelect = document.getElementById('withdrawProduct');
            
            addProductSelect.innerHTML = '';
            withdrawProductSelect.innerHTML = '';
            
            if (products.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ø³Ø¬Ù„Ø©';
                addProductSelect.appendChild(option);
                withdrawProductSelect.appendChild(option.cloneNode(true));
                return;
            }
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.name;
                option.textContent = product.name;
                addProductSelect.appendChild(option);
                withdrawProductSelect.appendChild(option.cloneNode(true));
            });
        }
        
        // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø®Ø§Ø²Ù† ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        function populateStorageSelects() {
            const storageSelect = document.getElementById('storageUnit');
            const addStorageSelect = document.getElementById('addStorage');
            const withdrawStorageSelect = document.getElementById('withdrawStorage');
            const inventoryStorageSelect = document.getElementById('inventoryStorage');
            const newStorageUnitSelect = document.getElementById('newStorageUnit');
            
            // ØªÙØ±ÙŠØº Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            storageSelect.innerHTML = '';
            addStorageSelect.innerHTML = '';
            withdrawStorageSelect.innerHTML = '';
            inventoryStorageSelect.innerHTML = '';
            newStorageUnitSelect.innerHTML = '';
            
            if (storages.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø²Ù† Ù…Ø³Ø¬Ù„Ø©';
                storageSelect.appendChild(option);
                return;
            }
            
            // Ù…Ù„Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            storages.forEach(storage => {
                const option = document.createElement('option');
                option.value = storage.name;
                option.textContent = storage.name;
                
                storageSelect.appendChild(option.cloneNode(true));
                addStorageSelect.appendChild(option.cloneNode(true));
                withdrawStorageSelect.appendChild(option.cloneNode(true));
                inventoryStorageSelect.appendChild(option.cloneNode(true));
                newStorageUnitSelect.appendChild(option.cloneNode(true));
            });
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (currentUser.storageUnit) {
                storageSelect.value = currentUser.storageUnit;
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const unit = document.getElementById('productUnit').value;
            const minStock = parseInt(document.getElementById('productMinStock').value);
            const category = document.getElementById('productCategory').value;
            const notes = document.getElementById('productNotes').value.trim();
            
            if (!name || isNaN(minStock) || minStock < 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙƒØ±Ø±
            if (products.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø© Ù…Ø³Ø¬Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                return;
            }
            
            const newProduct = {
                id: Date.now(), // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙƒÙ…Ø¹Ø±Ù ÙØ±ÙŠØ¯
                name,
                unit,
                minStock,
                category,
                notes
            };
            
            products.push(newProduct);
            saveData();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('productName').value = '';
            document.getElementById('productMinStock').value = '';
            document.getElementById('productNotes').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadProducts();
            populateProductSelects();
            updateStats();
            updateInventory();
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø­Ø±ÙƒØ© Ø¥Ø¶Ø§ÙØ©
        function addAddition() {
            const date = document.getElementById('addDate').value;
            const storage = document.getElementById('addStorage').value;
            const product = document.getElementById('addProduct').value;
            const quantity = parseInt(document.getElementById('addQuantity').value);
            const price = parseFloat(document.getElementById('addPrice').value);
            const supplier = document.getElementById('addSupplier').value.trim();
            const doc = document.getElementById('addDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || isNaN(price) || price < 0 || !supplier) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            const newAddition = {
                id: Date.now(),
                date,
                storage,
                product,
                quantity,
                price,
                supplier,
                doc: doc || '-'
            };
            
            additions.push(newAddition);
            saveData();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('addQuantity').value = '';
            document.getElementById('addPrice').value = '';
            document.getElementById('addSupplier').value = '';
            document.getElementById('addDoc').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadAdditions();
            updateStats();
            updateInventory();
            updateLastTransactions();
            
            alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø­Ø±ÙƒØ© ØµØ±Ù
        function addWithdrawal() {
            const date = document.getElementById('withdrawDate').value;
            const storage = document.getElementById('withdrawStorage').value;
            const product = document.getElementById('withdrawProduct').value;
            const quantity = parseInt(document.getElementById('withdrawQuantity').value);
            const receiver = document.getElementById('withdrawReceiver').value.trim();
            const doc = document.getElementById('withdrawDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || !receiver) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            const additionsTotal = additions
                .filter(a => a.product === product && a.storage === storage)
                .reduce((sum, a) => sum + a.quantity, 0);
            
            const withdrawalsTotal = withdrawals
                .filter(w => w.product === product && w.storage === storage)
                .reduce((sum, w) => sum + w.quantity, 0);
            
            const remaining = additionsTotal - withdrawalsTotal;
            
            if (quantity > remaining) {
                alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${quantity}) ØªØªØ¬Ø§ÙˆØ² Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© (${remaining}) ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯`);
                return;
            }
            
            const newWithdrawal = {
                id: Date.now(),
                date,
                storage,
                product,
                quantity,
                receiver,
                doc: doc || '-'
            };
            
            withdrawals.push(newWithdrawal);
            saveData();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('withdrawQuantity').value = '';
            document.getElementById('withdrawReceiver').value = '';
            document.getElementById('withdrawDoc').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadWithdrawals();
            updateStats();
            updateInventory();
            updateLastTransactions();
            
            alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²Ù† Ø¬Ø¯ÙŠØ¯
        function addStorage() {
            const name = document.getElementById('storageName').value.trim();
            const location = document.getElementById('storageLocation').value.trim();
            const manager = document.getElementById('storageManager').value.trim();
            const phone = document.getElementById('storagePhone').value.trim();
            
            if (!name || !location || !manager) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù† ØºÙŠØ± Ù…ÙƒØ±Ø±
            if (storages.some(s => s.name.toLowerCase() === name.toLowerCase())) {
                alert('Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø²Ù† Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                return;
            }
            
            const newStorage = {
                id: Date.now(),
                name,
                location,
                manager,
                phone
            };
            
            storages.push(newStorage);
            saveData();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('storageName').value = '';
            document.getElementById('storageLocation').value = '';
            document.getElementById('storageManager').value = '';
            document.getElementById('storagePhone').value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadStorages();
            populateStorageSelects();
            
            alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø²Ù† Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
        function saveData() {
            localStorage.setItem('construction_products', JSON.stringify(products));
            localStorage.setItem('construction_additions', JSON.stringify(additions));
            localStorage.setItem('construction_withdrawals', JSON.stringify(withdrawals));
            localStorage.setItem('construction_users', JSON.stringify(users));
            localStorage.setItem('construction_storages', JSON.stringify(storages));
        }
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø©
        function searchProduct() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (searchTerm.length < 1) {
                resultsDiv.innerHTML = '<p>Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø§Ø¯Ø© ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>';
                return;
            }
            
            const foundProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm)
            );
            
            if (foundProducts.length === 0) {
                resultsDiv.innerHTML = '<p class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«. Ø­Ø§ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰.</p>';
                return;
            }
            
            let resultsHTML = '<table><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
            
            foundProducts.forEach(product => {
                const additionsTotal = additions
                    .filter(a => a.product === product.name)
                    .reduce((sum, a) => sum + a.quantity, 0);
                
                const withdrawalsTotal = withdrawals
                    .filter(w => w.product === product.name)
                    .reduce((sum, w) => sum + w.quantity, 0);
                
                const remaining = additionsTotal - withdrawalsTotal;
                
                let status = 'status-good';
                let statusText = 'Ø¬ÙŠØ¯';
                
                if (remaining <= 0) {
                    status = 'status-danger';
                    statusText = 'Ù†ÙØ°';
                } else if (remaining <= product.minStock) {
                    status = 'status-warning';
                    statusText = 'Ù…Ù†Ø®ÙØ¶';
                }
                
                resultsHTML += `
                    <tr>
                        <td>${product.name}</td>
                        <td>${product.unit}</td>
                        <td>${remaining}</td>
                        <td class="${status}">${statusText}</td>
                    </tr>
                `;
            });
            
            resultsHTML += '</tbody></table>';
            resultsDiv.innerHTML = resultsHTML;
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
        function confirmDelete(id, type) {
            itemToDelete = id;
            itemTypeToDelete = type;
            
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            message.innerHTML = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ<br><strong>Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</strong>`;
            
            modal.style.display = 'block';
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function confirmDeleteUser(username) {
            itemToDelete = username;
            itemTypeToDelete = 'user';
            
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            message.innerHTML = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${username}"ØŸ<br><strong>Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</strong>`;
            
            modal.style.display = 'block';
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²Ù†
        function confirmDeleteStorage(id) {
            itemToDelete = id;
            itemTypeToDelete = 'storage';
            
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            message.innerHTML = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²Ù†ØŸ<br><strong>Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</strong>`;
            
            modal.style.display = 'block';
        }
        
        // ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø°Ù
        function deleteItem() {
            if (itemTypeToDelete === 'product') {
                // Ø­Ø°Ù Ù…Ø§Ø¯Ø©
                const productIndex = products.findIndex(p => p.id === itemToDelete);
                if (productIndex !== -1) {
                    const productName = products[productIndex].name;
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø­Ø±ÙƒØ§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©
                    const hasAdditions = additions.some(a => a.product === productName);
                    const hasWithdrawals = withdrawals.some(w => w.product === productName);
                    
                    if (hasAdditions || hasWithdrawals) {
                        alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ø£Ù†Ù‡Ø§ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø­Ø±ÙƒØ§Øª Ø³Ø§Ø¨Ù‚Ø©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø·ÙŠÙ„Ù‡Ø§ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ.');
                        closeModal('deleteModal');
                        return;
                    }
                    
                    products.splice(productIndex, 1);
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                }
            } else if (itemTypeToDelete === 'addition') {
                // Ø­Ø°Ù Ø¥Ø¶Ø§ÙØ©
                additions = additions.filter(a => a.id !== itemToDelete);
                alert('ØªÙ… Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!');
            } else if (itemTypeToDelete === 'withdrawal') {
                // Ø­Ø°Ù ØµØ±Ù
                withdrawals = withdrawals.filter(w => w.id !== itemToDelete);
                alert('ØªÙ… Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­!');
            } else if (itemTypeToDelete === 'user') {
                // Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…
                users = users.filter(u => u.username !== itemToDelete);
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!');
            } else if (itemTypeToDelete === 'storage') {
                // Ø­Ø°Ù Ù…Ø®Ø²Ù†
                const storageIndex = storages.findIndex(s => s.id === itemToDelete);
                if (storageIndex !== -1) {
                    const storageName = storages[storageIndex].name;
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø­Ø±ÙƒØ§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø²Ù†
                    const hasAdditions = additions.some(a => a.storage === storageName);
                    const hasWithdrawals = withdrawals.some(w => w.storage === storageName);
                    
                    if (hasAdditions || hasWithdrawals) {
                        alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø²Ù† Ù„Ø£Ù†Ù‡ Ù…Ø±ØªØ¨Ø· Ø¨Ø­Ø±ÙƒØ§Øª Ø³Ø§Ø¨Ù‚Ø©.');
                        closeModal('deleteModal');
                        return;
                    }
                    
                    storages.splice(storageIndex, 1);
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø®Ø²Ù† Ø¨Ù†Ø¬Ø§Ø­!');
                }
            }
            
            saveData();
            closeModal('deleteModal');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            loadProducts();
            loadAdditions();
            loadWithdrawals();
            loadUsers();
            loadStorages();
            populateProductSelects();
            populateStorageSelects();
            updateStats();
            updateInventory();
            updateLastTransactions();
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø§Ø¯Ø©
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø©: ${product.name}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editProductName">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="editProductName" value="${product.name}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
                </div>
                <div class="form-group">
                    <label for="editProductUnit">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select id="editProductUnit">
                        <option value="ÙƒØ¬Ù…" ${product.unit === 'ÙƒØ¬Ù…' ? 'selected' : ''}>ÙƒØ¬Ù…</option>
                        <option value="Ø´ÙŠÙƒØ§Ø±Ø©" ${product.unit === 'Ø´ÙŠÙƒØ§Ø±Ø©' ? 'selected' : ''}>Ø´ÙŠÙƒØ§Ø±Ø©</option>
                        <option value="Ø·Ù†" ${product.unit === 'Ø·Ù†' ? 'selected' : ''}>Ø·Ù†</option>
                        <option value="Ù…ØªØ±" ${product.unit === 'Ù…ØªØ±' ? 'selected' : ''}>Ù…ØªØ±</option>
                        <option value="Ù…ØªØ± Ù…ÙƒØ¹Ø¨" ${product.unit === 'Ù…ØªØ± Ù…ÙƒØ¹Ø¨' ? 'selected' : ''}>Ù…ØªØ± Ù…ÙƒØ¹Ø¨</option>
                        <option value="Ù„ØªØ±" ${product.unit === 'Ù„ØªØ±' ? 'selected' : ''}>Ù„ØªØ±</option>
                        <option value="Ø¹Ù„Ø¨Ø©" ${product.unit === 'Ø¹Ù„Ø¨Ø©' ? 'selected' : ''}>Ø¹Ù„Ø¨Ø©</option>
                        <option value="ÙƒÙŠØ³" ${product.unit === 'ÙƒÙŠØ³' ? 'selected' : ''}>ÙƒÙŠØ³</option>
                        <option value="Ù‚Ø·Ø¹Ø©" ${product.unit === 'Ù‚Ø·Ø¹Ø©' ? 'selected' : ''}>Ù‚Ø·Ø¹Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductMinStock">Ø­Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨</label>
                    <input type="number" id="editProductMinStock" value="${product.minStock}" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†">
                </div>
                <div class="form-group">
                    <label for="editProductCategory">Ø§Ù„ÙØ¦Ø©</label>
                    <select id="editProductCategory">
                        <option value="Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡" ${product.category === 'Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡' ? 'selected' : ''}>Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡</option>
                        <option value="Ø¯Ù‡Ø§Ù†Ø§Øª" ${product.category === 'Ø¯Ù‡Ø§Ù†Ø§Øª' ? 'selected' : ''}>Ø¯Ù‡Ø§Ù†Ø§Øª</option>
                        <option value="Ø£Ø¯ÙˆØ§Øª" ${product.category === 'Ø£Ø¯ÙˆØ§Øª' ? 'selected' : ''}>Ø£Ø¯ÙˆØ§Øª</option>
                        <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡" ${product.category === 'ÙƒÙ‡Ø±Ø¨Ø§Ø¡' ? 'selected' : ''}>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                        <option value="Ø³Ø¨Ø§ÙƒØ©" ${product.category === 'Ø³Ø¨Ø§ÙƒØ©' ? 'selected' : ''}>Ø³Ø¨Ø§ÙƒØ©</option>
                        <option value="Ø£Ø®Ø±Ù‰" ${product.category === 'Ø£Ø®Ø±Ù‰' ? 'selected' : ''}>Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <input type="text" id="editProductNotes" value="${product.notes || ''}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                </div>
                <button class="btn btn-success btn-full" onclick="saveProduct(${id})"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¯Ø©
        function saveProduct(id) {
            const name = document.getElementById('editProductName').value.trim();
            const unit = document.getElementById('editProductUnit').value;
            const minStock = parseInt(document.getElementById('editProductMinStock').value);
            const category = document.getElementById('editProductCategory').value;
            const notes = document.getElementById('editProductNotes').value.trim();
            
            if (!name || isNaN(minStock) || minStock < 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            const index = products.findIndex(p => p.id === id);
            if (index !== -1) {
                // Ø¥Ø°Ø§ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
                if (name !== products[index].name && products.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                    alert('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                    return;
                }
                
                products[index] = { ...products[index], name, unit, minStock, category, notes };
                saveData();
                alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('editModal');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                loadProducts();
                populateProductSelects();
                updateInventory();
            }
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¶Ø§ÙØ©
        function editAddition(id) {
            const addition = additions.find(a => a.id === id);
            if (!addition) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${addition.product}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editAddDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="editAddDate" value="${addition.date}">
                </div>
                <div class="form-group">
                    <label for="editAddStorage">Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <select id="editAddStorage">
                        ${storages.map(s => `<option value="${s.name}" ${s.name === addition.storage ? 'selected' : ''}>${s.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editAddProduct">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="editAddProduct">
                        ${products.map(p => `<option value="${p.name}" ${p.name === addition.product ? 'selected' : ''}>${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editAddQuantity">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                    <input type="number" id="editAddQuantity" value="${addition.quantity}" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ©">
                </div>
                <div class="form-group">
                    <label for="editAddPrice">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <input type="number" id="editAddPrice" value="${addition.price}" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©" step="0.01">
                </div>
                <div class="form-group">
                    <label for="editAddSupplier">Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                    <input type="text" id="editAddSupplier" value="${addition.supplier}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
                </div>
                <div class="form-group">
                    <label for="editAddDoc">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>
                    <input type="text" id="editAddDoc" value="${addition.doc}" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯">
                </div>
                <button class="btn btn-success btn-full" onclick="saveAddition(${id})"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        function saveAddition(id) {
            const date = document.getElementById('editAddDate').value;
            const storage = document.getElementById('editAddStorage').value;
            const product = document.getElementById('editAddProduct').value;
            const quantity = parseInt(document.getElementById('editAddQuantity').value);
            const price = parseFloat(document.getElementById('editAddPrice').value);
            const supplier = document.getElementById('editAddSupplier').value.trim();
            const doc = document.getElementById('editAddDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || isNaN(price) || price < 0 || !supplier) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            const index = additions.findIndex(a => a.id === id);
            if (index !== -1) {
                additions[index] = { ...additions[index], date, storage, product, quantity, price, supplier, doc: doc || '-' };
                saveData();
                alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('editModal');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                loadAdditions();
                updateStats();
                updateInventory();
                updateLastTransactions();
            }
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ ØµØ±Ù
        function editWithdrawal(id) {
            const withdrawal = withdrawals.find(w => w.id === id);
            if (!withdrawal) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ±Ù: ${withdrawal.product}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editWithdrawDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="editWithdrawDate" value="${withdrawal.date}">
                </div>
                <div class="form-group">
                    <label for="editWithdrawStorage">Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <select id="editWithdrawStorage">
                        ${storages.map(s => `<option value="${s.name}" ${s.name === withdrawal.storage ? 'selected' : ''}>${s.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editWithdrawProduct">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="editWithdrawProduct">
                        ${products.map(p => `<option value="${p.name}" ${p.name === withdrawal.product ? 'selected' : ''}>${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label for="editWithdrawQuantity">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                    <input type="number" id="editWithdrawQuantity" value="${withdrawal.quantity}" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙˆÙØ©">
                </div>
                <div class="form-group">
                    <label for="editWithdrawReceiver">Ø§Ù„Ù…Ø³ØªÙ„Ù…/Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="text" id="editWithdrawReceiver" value="${withdrawal.receiver}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">
                </div>
                <div class="form-group">
                    <label for="editWithdrawDoc">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>
                    <input type="text" id="editWithdrawDoc" value="${withdrawal.doc}" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯">
                </div>
                <button class="btn btn-success btn-full" onclick="saveWithdrawal(${id})"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØµØ±Ù
        function saveWithdrawal(id) {
            const date = document.getElementById('editWithdrawDate').value;
            const storage = document.getElementById('editWithdrawStorage').value;
            const product = document.getElementById('editWithdrawProduct').value;
            const quantity = parseInt(document.getElementById('editWithdrawQuantity').value);
            const receiver = document.getElementById('editWithdrawReceiver').value.trim();
            const doc = document.getElementById('editWithdrawDoc').value.trim();
            
            if (!date || !storage || !product || isNaN(quantity) || quantity <= 0 || !receiver) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
            const additionsTotal = additions
                .filter(a => a.product === product && a.storage === storage)
                .reduce((sum, a) => sum + a.quantity, 0);
            
            const currentWithdrawal = withdrawals.find(w => w.id === id);
            const otherWithdrawalsTotal = withdrawals
                .filter(w => w.product === product && w.storage === storage && w.id !== id)
                .reduce((sum, w) => sum + w.quantity, 0);
            
            const remaining = additionsTotal - otherWithdrawalsTotal;
            
            if (quantity > remaining) {
                alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${quantity}) ØªØªØ¬Ø§ÙˆØ² Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© (${remaining}) ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯`);
                return;
            }
            
            const index = withdrawals.findIndex(w => w.id === id);
            if (index !== -1) {
                withdrawals[index] = { ...withdrawals[index], date, storage, product, quantity, receiver, doc: doc || '-' };
                saveData();
                alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('editModal');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                loadWithdrawals();
                updateStats();
                updateInventory();
                updateLastTransactions();
            }
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø®Ø²Ù†
        function editStorage(id) {
            const storage = storages.find(s => s.id === id);
            if (!storage) return;
            
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editModalTitle');
            const content = document.getElementById('editModalContent');
            
            title.textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²Ù†: ${storage.name}`;
            
            content.innerHTML = `
                <div class="form-group">
                    <label for="editStorageName">Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <input type="text" id="editStorageName" value="${storage.name}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†">
                </div>
                <div class="form-group">
                    <label for="editStorageLocation">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <input type="text" id="editStorageLocation" value="${storage.location}" placeholder="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø®Ø²Ù†">
                </div>
                <div class="form-group">
                    <label for="editStorageManager">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                    <input type="text" id="editStorageManager" value="${storage.manager}" placeholder="Ø§Ø³Ù… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²Ù†">
                </div>
                <div class="form-group">
                    <label for="editStoragePhone">Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø®Ø²Ù†</label>
                    <input type="text" id="editStoragePhone" value="${storage.phone}" placeholder="Ù‡Ø§ØªÙ Ø§Ù„Ø§ØªØµØ§Ù„">
                </div>
                <button class="btn btn-success btn-full" onclick="saveStorage(${id})"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            `;
            
            modal.style.display = 'block';
        }
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø²Ù†
        function saveStorage(id) {
            const name = document.getElementById('editStorageName').value.trim();
            const location = document.getElementById('editStorageLocation').value.trim();
            const manager = document.getElementById('editStorageManager').value.trim();
            const phone = document.getElementById('editStoragePhone').value.trim();
            
            if (!name || !location || !manager) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            const index = storages.findIndex(s => s.id === id);
            if (index !== -1) {
                // Ø¥Ø°Ø§ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
                if (name !== storages[index].name && storages.some(s => s.name.toLowerCase() === name.toLowerCase())) {
                    alert('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                    return;
                }
                
                storages[index] = { ...storages[index], name, location, manager, phone };
                saveData();
                alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²Ù† Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('editModal');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                loadStorages();
                populateStorageSelects();
            }
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function editUserPermission(username) {
            const user = users.find(u => u.username === username);
            if (!user) return;
            
            userToEdit = username;
            
            const modal = document.getElementById('permissionModal');
            const title = document.getElementById('permissionModalTitle');
            const permissionSelect = document.getElementById('userPermission');
            
            title.textContent = `ØªØºÙŠÙŠØ± ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${username}`;
            permissionSelect.value = user.isAdmin ? 'admin' : 'user';
            
            modal.style.display = 'block';
        }
        
        // Ø­ÙØ¸ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function saveUserPermission() {
            if (!userToEdit) return;
            
            const permission = document.getElementById('userPermission').value;
            const isAdmin = permission === 'admin';
            
            const index = users.findIndex(u => u.username === userToEdit);
            if (index !== -1) {
                users[index].isAdmin = isAdmin;
                saveData();
                alert('ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('permissionModal');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                loadUsers();
            }
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø±ÙƒØ© (Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)
        function editTransaction(id, type) {
            if (type === 'addition') {
                editAddition(id);
            } else {
                editWithdrawal(id);
            }
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            userToEdit = null;
        }
        
        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        function printReport() {
            const selectedStorage = document.getElementById('inventoryStorage').value;
            const storageTitle = selectedStorage ? ` - ${selectedStorage}` : '';
            
            const printContent = `
                <div dir="rtl">
                    <h1 style="text-align: center;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ${storageTitle}</h1>
                    <p style="text-align: center;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p>
                    <hr>
                    <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
                    ${document.getElementById('inventorySummary').outerHTML}
                    <hr>
                    <h2>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©</h2>
                    ${document.getElementById('lowStockItems').outerHTML}
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
                        th, td { padding: 8px; text-align: right; border-bottom: 1px solid #ddd; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>${printContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function exportData() {
            const data = {
                products,
                additions,
                withdrawals,
                users,
                storages
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "construction_data_" + new Date().toISOString().split('T')[0] + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const storageUnit = document.getElementById('storageUnit').value;
            
            if (!username || !password || !storageUnit) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                initSystem();
            } else {
                alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            currentUser = null;
            document.getElementById('app').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function showRegisterForm() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.remove('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø®ÙŠØ§Ø± Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†
            if (currentUser && currentUser.isAdmin) {
                document.getElementById('adminCheckboxContainer').style.display = 'block';
            }
        }
        
        // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function showLoginForm() {
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
        function register() {
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const storageUnit = document.getElementById('newStorageUnit').value;
            const isAdmin = document.getElementById('isAdmin') ? document.getElementById('isAdmin').checked : false;
            
            if (!username || !password || !confirmPassword || !storageUnit) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
                return;
            }
            
            if (users.some(u => u.username === username)) {
                alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                return;
            }
            
            const newUser = {
                username,
                password,
                storageUnit,
                isAdmin,
                registrationDate: new Date().toLocaleDateString('ar-EG')
            };
            
            users.push(newUser);
            saveData();
            
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            showLoginForm();
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let i = 0; i < modals.length; i++) {
                if (event.target == modals[i]) {
                    modals[i].style.display = 'none';
                    userToEdit = null;
                }
            }
        };
        
        // ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            const tabButtons = document.getElementsByClassName('tab');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙŠØ³ Ù…Ø¯ÙŠØ±Ø§Ù‹ØŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±
            if ((tabName === 'users' || tabName === 'storage') && (!currentUser || !currentUser.isAdmin)) {
                alert('Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†');
                document.getElementById(tabName).classList.remove('active');
                document.getElementById('main').classList.add('active');
                
                const tab = document.querySelector(`.tab[onclick="openTab('${tabName}')"]`);
                if (tab) tab.classList.remove('active');
                
                document.querySelector('.tab[onclick="openTab(\'main\')"]').classList.add('active');
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = function() {
            // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø®Ø§Ø²Ù† ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            const storageUnitSelect = document.getElementById('storageUnit');
            const newStorageUnitSelect = document.getElementById('newStorageUnit');
            
            storages.forEach(storage => {
                const option = document.createElement('option');
                option.value = storage.name;
                option.textContent = storage.name;
                
                storageUnitSelect.appendChild(option.cloneNode(true));
                newStorageUnitSelect.appendChild(option.cloneNode(true));
            });
        };
    </script>
</body>
</html>